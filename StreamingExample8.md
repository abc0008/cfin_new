

<Post_Visualization_Streaming_Response>

Key observations from the deposit performance:

1. Consistent Growth: The line chart shows a steady upward trajectory in total deposits, with no quarterly declines.

2. Deposit Mix Stability: As shown in the detailed table, all deposit categories maintained positive growth, with Non-interest DDA showing the strongest percentage increase at 5.83%.

3. Core Deposit Strength: Money Market accounts and Non-interest DDA, which are typically considered core deposits, represent the largest portions of the deposit base and show healthy growth trends.

4. Growth Rate: The annualized growth rate of 3.7% indicates a stable and sustainable deposit gathering environment.

5. Diversification: The deposit base remains well-diversified across different product types, which helps manage funding costs and liquidity risks.

The overall deposit performance suggests strong and stable funding conditions for the bank, with growth across all major deposit categories and a healthy mix of deposit types.





</Post_Visualization_Streaming_Response>

<JavaScript_Console_Output>
[Info] Successfully preconnected to https://fonts.googleapis.com/
[Info] Successfully preconnected to https://fonts.gstatic.com/
[Error] Failed to load resource: the server responded with a status of 400 () (font, line 0)
[Error] Failed to load resource: the server responded with a status of 400 () (font, line 0)
[Log] üåê API Service Available
[Log] Use __apiService to access the API directly in the console
[Log] Sending POST request to http://localhost:8000/api/conversation
[Log] Sending POST request to http://localhost:8000/api/conversation
[Log] Created conversation session: 420e1780-8a55-4cf3-8521-6a87120df723
[Log] Created conversation session: f7fd8219-d96d-4bfc-872e-27ae595a514e
[Log] Created conversation session: ‚Äì "f7fd8219-d96d-4bfc-872e-27ae595a514e"
[Log] Validating conversation exists: ‚Äì "f7fd8219-d96d-4bfc-872e-27ae595a514e"
[Log] Sending GET request to http://localhost:8000/api/conversation/f7fd8219-d96d-4bfc-872e-27ae595a514e
[Log] Starting WebSocket connection to: ‚Äì "ws://localhost:8000/ws/conversation/f7fd8219-d96d-4bfc-872e-27ae595a514e"
[Log] Current isConnected state before connection: ‚Äì false
[Log] WebSocket onopen event fired for conversation: ‚Äì "f7fd8219-d96d-4bfc-872e-27ae595a514e"
[Log] WebSocket connected and isConnected set to true for conversation: ‚Äì "f7fd8219-d96d-4bfc-872e-27ae595a514e"
[Log] File selected: ‚Äì "Bank_5Q_Trend_Report.pdf"
[Log] Validating file: ‚Äì "Bank_5Q_Trend_Report.pdf"
[Log] File validation successful
[Log] Uploading document...
[Log] Upload progress: 0.00%, Stage: Starting upload
[Log] Uploading file to http://localhost:8000/api/documents/upload
[Log] Upload progress: 40.00%, Stage: Uploading file
[Log] Polling for document processing completion...
[Log] Upload progress: 40.00%, Stage: Processing document
[Log] Upload progress: 40.00%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 1: processing
[Log] Upload progress: 40.27%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 2: processing
[Log] Upload progress: 40.53%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 3: processing
[Log] Upload progress: 40.80%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 4: processing
[Log] Upload progress: 41.07%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 5: processing
[Log] Upload progress: 41.33%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 6: processing
[Log] Upload progress: 41.60%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 7: processing
[Log] Upload progress: 41.87%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 8: processing
[Log] Upload progress: 42.13%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 9: processing
[Log] Upload progress: 42.40%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 10: processing
[Log] Upload progress: 42.67%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 11: processing
[Log] Upload progress: 42.93%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 12: processing
[Log] Upload progress: 43.20%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 13: processing
[Log] Upload progress: 43.47%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 14: processing
[Log] Upload progress: 43.73%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 15: processing
[Log] Upload progress: 44.00%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document status after attempt 16: completed
[Log] Verifying financial data...
[Log] Upload progress: 80.00%, Stage: Verifying financial data
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee/check-financial-data
[Log] Document needs financial data verification: ‚Äì "Document accepted for financial analysis"
[Log] Upload progress: 85.00%, Stage: Enhancing financial data
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee/check-financial-data
[Log] Sending POST request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee/verify-financial-data
[Log] Financial data verification result: ‚Äì {success: true, message: "Document content verified for analysis"}
[Log] Upload progress: 90.00%, Stage: Retrieving enhanced data
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Upload progress: 100.00%, Stage: Document ready
[Log] Document verification completed: ‚Äì {metadata: Object, contentType: "other", extractionTimestamp: "2025-06-20T20:57:26.607Z", ‚Ä¶}
{metadata: Object, contentType: "other", extractionTimestamp: "2025-06-20T20:57:26.607Z", periods: ["2024Q1", "2024Q2", "2024Q3", "2024Q4", "2025Q1"], extractedData: Object, ‚Ä¶}Object
[Log] Associating document ed242f95-708f-42cf-a7a7-4db9dc19a0ee with conversation f7fd8219-d96d-4bfc-872e-27ae595a514e
[Log] Sending POST request to http://localhost:8000/api/conversation/f7fd8219-d96d-4bfc-872e-27ae595a514e/document/ed242f95-708f-42cf-a7a7-4db9dc19a0ee
[Log] Document ed242f95-708f-42cf-a7a7-4db9dc19a0ee added to conversation f7fd8219-d96d-4bfc-872e-27ae595a514e
[Log] Document successfully associated with conversation
[Log] [Fast Refresh] rebuilding
[Log] PDFViewer unmounting, cleaning up resources
[Log] Sending GET request to http://localhost:8000/api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee/citations
[Log] [Fast Refresh] done in 199ms
[Error] Source Map loading errors (x2)
[Error] Failed to load resource: the server responded with a status of 404 (Not Found) (types.js.map, line 0)
[Error] Failed to load resource: the server responded with a status of 404 (Not Found) (types.js.map, line 0)
[Log] Deprecated API usage: The `enhanceTextSelection` functionality will be removed in the future. (x4)
[Log] Submit conditions: useStreaming=true, conversationId=f7fd8219-d96d-4bfc-872e-27ae595a514e, isConnected=true
[Log] Using WebSocket streaming for message submission
[Log] üîÑ Starting new message - reset streaming state
[Log] Message start: Set streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üîÑ Starting new message - reset streaming state
[Log] Message start: Set streamingMessageId to msg_01JhLmVHMqpB4NJFudeAQh95
[Log] üìù Building initial streaming: 3 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 3 chars
[Log] üìù Building initial streaming: 71 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 71 chars
[Log] üìù Building initial streaming: 96 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 96 chars
[Log] üìù Building initial streaming: 120 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 120 chars
[Log] üìù Building initial streaming: 158 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 158 chars
[Log] üìù Building initial streaming: 181 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 181 chars
[Log] üìù Building initial streaming: 188 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 188 chars
[Log] üìù Building initial streaming: 201 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 201 chars
[Log] üìù Building initial streaming: 230 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 230 chars
[Log] üìù Building initial streaming: 259 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 259 chars
[Log] üìù Building initial streaming: 271 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 271 chars
[Log] üìù Building initial streaming: 280 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 280 chars
[Log] üìù Building initial streaming: 288 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 288 chars
[Log] üìù Building initial streaming: 305 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 305 chars
[Log] üìù Building initial streaming: 324 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 324 chars
[Log] üìù Building initial streaming: 330 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 330 chars
[Log] üìù Building initial streaming: 354 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 354 chars
[Log] üìù Building initial streaming: 370 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 370 chars
[Log] üìù Building initial streaming: 385 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 385 chars
[Log] üìù Building initial streaming: 400 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 400 chars
[Log] üìù Building initial streaming: 427 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 427 chars
[Log] üìù Building initial streaming: 450 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 450 chars
[Log] üìù Building initial streaming: 483 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 483 chars
[Log] üìù Building initial streaming: 500 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 500 chars
[Log] üìù Building initial streaming: 505 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 505 chars
[Log] üìù Building initial streaming: 513 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 513 chars
[Log] üìù Building initial streaming: 522 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 522 chars
[Log] üìù Building initial streaming: 527 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 527 chars
[Log] üìù Building initial streaming: 536 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 536 chars
[Log] üìù Building initial streaming: 566 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 566 chars
[Log] üìù Building initial streaming: 584 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 584 chars
[Log] üìù Building initial streaming: 593 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 593 chars
[Log] üìù Building initial streaming: 597 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 597 chars
[Log] üìù Building initial streaming: 609 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 609 chars
[Log] üìù Building initial streaming: 616 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 616 chars
[Log] üìù Building initial streaming: 627 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 627 chars
[Log] üìù Building initial streaming: 636 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 636 chars
[Log] üìù Building initial streaming: 660 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 660 chars
[Log] üìù Building initial streaming: 684 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 684 chars
[Log] üìù Building initial streaming: 688 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 688 chars
[Log] üìù Building initial streaming: 697 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 697 chars
[Log] üìù Building initial streaming: 708 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 708 chars
[Log] üìù Building initial streaming: 718 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 718 chars
[Log] üìù Building initial streaming: 751 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 751 chars
[Log] üìù Building initial streaming: 773 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 773 chars
[Log] üìù Building initial streaming: 781 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 781 chars
[Log] üìù Building initial streaming: 788 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 788 chars
[Log] üìù Building initial streaming: 794 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 794 chars
[Log] üìù Building initial streaming: 815 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 815 chars
[Log] üìù Building initial streaming: 830 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 830 chars
[Log] üìù Building initial streaming: 842 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 842 chars
[Log] üìù Building initial streaming: 851 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 851 chars
[Log] üìù Building initial streaming: 904 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 904 chars
[Log] üìù Building initial streaming: 918 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 918 chars
[Log] üîß Tool started: generate_graph_data (toolu_0128yjBkDSGQYpdi3MCzKqKW) - will create separate tool message
[Log] Tool complete: Setting missing streamingMessageId to msg_01JhLmVHMqpB4NJFudeAQh95
[Log] Tool complete: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üîÑ Starting new message - reset streaming state
[Log] Message start: Set streamingMessageId to msg_01NvK6dAdXVGWWeHyegxmkMg
[Log] üîß Tool started: generate_table_data (toolu_01XYqBGcAVtTVGuaDiMjoQZV) - will create separate tool message
[Log] Tool complete: Setting missing streamingMessageId to msg_01NvK6dAdXVGWWeHyegxmkMg
[Log] Tool complete: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üîÑ Starting new message - reset streaming state
[Log] Message start: Set streamingMessageId to msg_018Gepwa4wGYgYcBf1R7ZEAe
[Log] üîß Tool started: generate_financial_metric (toolu_01YcE2tTGpVwYZgF2FBNLD9E) - will create separate tool message
[Log] Tool complete: Setting missing streamingMessageId to msg_018Gepwa4wGYgYcBf1R7ZEAe
[Log] Tool complete: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üîÑ Starting new message - reset streaming state
[Log] Message start: Set streamingMessageId to msg_014XvWGM2HJqUgwFMj7dYHiG
[Log] üìù Building initial streaming: 3 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 3 chars
[Log] üìù Building initial streaming: 45 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 45 chars
[Log] üìù Building initial streaming: 50 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 50 chars
[Log] üìù Building initial streaming: 78 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 78 chars
[Log] üìù Building initial streaming: 99 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 99 chars
[Log] üìù Building initial streaming: 117 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 117 chars
[Log] üìù Building initial streaming: 136 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 136 chars
[Log] üìù Building initial streaming: 164 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 164 chars
[Log] üìù Building initial streaming: 176 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 176 chars
[Log] üìù Building initial streaming: 194 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 194 chars
[Log] üìù Building initial streaming: 223 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 223 chars
[Log] üìù Building initial streaming: 256 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 256 chars
[Log] üìù Building initial streaming: 283 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 283 chars
[Log] üìù Building initial streaming: 304 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 304 chars
[Log] üìù Building initial streaming: 344 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 344 chars
[Log] üìù Building initial streaming: 352 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 352 chars
[Log] üìù Building initial streaming: 365 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 365 chars
[Log] üìù Building initial streaming: 397 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 397 chars
[Log] üìù Building initial streaming: 419 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 419 chars
[Log] üìù Building initial streaming: 475 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 475 chars
[Log] üìù Building initial streaming: 503 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 503 chars
[Log] üìù Building initial streaming: 533 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 533 chars
[Log] üìù Building initial streaming: 559 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 559 chars
[Log] üìù Building initial streaming: 574 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 574 chars
[Log] üìù Building initial streaming: 600 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 600 chars
[Log] üìù Building initial streaming: 635 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 635 chars
[Log] üìù Building initial streaming: 670 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 670 chars
[Log] üìù Building initial streaming: 704 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 704 chars
[Log] üìù Building initial streaming: 736 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 736 chars
[Log] üìù Building initial streaming: 773 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 773 chars
[Log] üìù Building initial streaming: 820 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 820 chars
[Log] üìù Building initial streaming: 867 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 867 chars
[Log] üìù Building initial streaming: 908 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 908 chars
[Log] üìù Building initial streaming: 956 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 956 chars
[Log] üìù Building initial streaming: 985 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 985 chars
[Log] üìù Building initial streaming: 992 chars
[Log] Content update: Setting missing streamingMessageId to ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
[Log] üìù Initial streaming update: 992 chars
[Error] Streaming error: ‚Äì "Error processing message: A transaction is already begun on this Session."
	(anonymous function) (app-index.js:33)
	(anonymous function) (hydration-error-info.js:63)
	onError (StreamingChatInterface.tsx:46)
	(anonymous function) (useStreamingChat.ts:281)
	(anonymous function) (useStreamingChat.ts:365)
[Log] Checking 2 messages for cumulative visualization data...
[Log] No structured visualization data found in messages or analysis results, returning empty structure
[Log] Checking 2 messages for cumulative visualization data...
[Log] No structured visualization data found in messages or analysis results, returning empty structure
[Log] PDFViewer unmounting, cleaning up resources
[Log] Checking 2 messages for cumulative visualization data...
[Log] No structured visualization data found in messages or analysis results, returning empty structure
[Log] Checking 2 messages for cumulative visualization data...
[Log] No structured visualization data found in messages or analysis results, returning empty structure
</JavaScript_Console_Output>

<Backend_Logs>
INFO:     Application startup complete.
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     127.0.0.1:59881 - "GET /api/conversation/65107daf-b0b4-4a90-849e-db9e78ad56db HTTP/1.1" 200 OK
INFO:app.routes.websocket:WebSocket endpoint called for conversation: 65107daf-b0b4-4a90-849e-db9e78ad56db, user: default-user
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     ('127.0.0.1', 59881) - "WebSocket /ws/conversation/65107daf-b0b4-4a90-849e-db9e78ad56db" [accepted]
INFO:app.routes.websocket:WebSocket connected: default-user_65107daf-b0b4-4a90-849e-db9e78ad56db_1750452581720
INFO:app.routes.websocket:WebSocket connection established for conversation: 65107daf-b0b4-4a90-849e-db9e78ad56db
INFO:     connection open
INFO:app.routes.websocket:Found conversation: 65107daf-b0b4-4a90-849e-db9e78ad56db
WARNING:  StatReload detected changes in 'services/conversation_service.py'. Reloading...
INFO:     Shutting down
INFO:app.routes.websocket:WebSocket disconnected: default-user_65107daf-b0b4-4a90-849e-db9e78ad56db_1750452581720
INFO:     connection closed
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [1972]
INFO:root:Loaded environment variables from /Users/alexcardell/AlexCoding_Local/cfin/.env
INFO:root:ANTHROPIC_API_KEY loaded: sk-ant-a...TQAA
INFO:app.main:CORS: Allowing origins: ['http://localhost:3000', 'http://localhost:3001', 'http://localhost:3002', 'http://localhost:3003', 'http://127.0.0.1:3000', 'http://127.0.0.1:3001', 'http://127.0.0.1:3002', 'http://127.0.0.1:3003', 'http://127.0.0.1:49937', 'http://127\\.0\\.0\\.1:\\d+', 'http://127.0.0.1:64142']
INFO:     Started server process [2019]
INFO:     Waiting for application startup.
INFO:app.main:Initializing database...
INFO:utils.init_db:Creating database tables...
INFO:utils.init_db:Database tables created successfully.
INFO:utils.init_db:Default user already exists.
INFO:utils.init_db:Database initialization completed successfully.
INFO:app.main:Database initialization completed successfully
INFO:     Application startup complete.
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     127.0.0.1:59917 - "GET /api/conversation/65107daf-b0b4-4a90-849e-db9e78ad56db HTTP/1.1" 200 OK
INFO:app.routes.websocket:WebSocket endpoint called for conversation: 65107daf-b0b4-4a90-849e-db9e78ad56db, user: default-user
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     ('127.0.0.1', 59917) - "WebSocket /ws/conversation/65107daf-b0b4-4a90-849e-db9e78ad56db" [accepted]
INFO:app.routes.websocket:WebSocket connected: default-user_65107daf-b0b4-4a90-849e-db9e78ad56db_1750452614642
INFO:app.routes.websocket:WebSocket connection established for conversation: 65107daf-b0b4-4a90-849e-db9e78ad56db
INFO:     connection open
INFO:app.routes.websocket:Found conversation: 65107daf-b0b4-4a90-849e-db9e78ad56db
INFO:app.routes.websocket:WebSocket disconnected: default-user_65107daf-b0b4-4a90-849e-db9e78ad56db_1750452614642
INFO:     connection closed
INFO:     127.0.0.1:60101 - "OPTIONS /api/conversation HTTP/1.1" 200 OK
INFO:     127.0.0.1:60102 - "OPTIONS /api/conversation HTTP/1.1" 200 OK
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.conversation:Created conversation: ad9ddcde-1580-4532-8152-df6774e15979 for user: default-user
INFO:app.routes.conversation:Created conversation: 8c26db8f-09a6-4e39-9a6b-47fef3f4da51 for user: default-user
INFO:     127.0.0.1:60101 - "POST /api/conversation HTTP/1.1" 201 Created
INFO:     127.0.0.1:60102 - "POST /api/conversation HTTP/1.1" 201 Created
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     127.0.0.1:60101 - "GET /api/conversation/8c26db8f-09a6-4e39-9a6b-47fef3f4da51 HTTP/1.1" 200 OK
INFO:app.routes.websocket:WebSocket endpoint called for conversation: 8c26db8f-09a6-4e39-9a6b-47fef3f4da51, user: default-user
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     ('127.0.0.1', 60102) - "WebSocket /ws/conversation/8c26db8f-09a6-4e39-9a6b-47fef3f4da51" [accepted]
INFO:app.routes.websocket:WebSocket connected: default-user_8c26db8f-09a6-4e39-9a6b-47fef3f4da51_1750452885972
INFO:app.routes.websocket:WebSocket connection established for conversation: 8c26db8f-09a6-4e39-9a6b-47fef3f4da51
INFO:     connection open
INFO:app.routes.websocket:Found conversation: 8c26db8f-09a6-4e39-9a6b-47fef3f4da51
INFO:app.routes.websocket:WebSocket disconnected: default-user_8c26db8f-09a6-4e39-9a6b-47fef3f4da51_1750452885972
INFO:     connection closed
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.conversation:Created conversation: 420e1780-8a55-4cf3-8521-6a87120df723 for user: default-user
INFO:     127.0.0.1:60215 - "POST /api/conversation HTTP/1.1" 201 Created
INFO:app.routes.conversation:Created conversation: f7fd8219-d96d-4bfc-872e-27ae595a514e for user: default-user
INFO:     127.0.0.1:60216 - "POST /api/conversation HTTP/1.1" 201 Created
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     127.0.0.1:60215 - "GET /api/conversation/f7fd8219-d96d-4bfc-872e-27ae595a514e HTTP/1.1" 200 OK
INFO:app.routes.websocket:WebSocket endpoint called for conversation: f7fd8219-d96d-4bfc-872e-27ae595a514e, user: default-user
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     ('127.0.0.1', 60216) - "WebSocket /ws/conversation/f7fd8219-d96d-4bfc-872e-27ae595a514e" [accepted]
INFO:app.routes.websocket:WebSocket connected: default-user_f7fd8219-d96d-4bfc-872e-27ae595a514e_1750453017855
INFO:app.routes.websocket:WebSocket connection established for conversation: f7fd8219-d96d-4bfc-872e-27ae595a514e
INFO:     connection open
INFO:app.routes.websocket:Found conversation: f7fd8219-d96d-4bfc-872e-27ae595a514e
INFO:     127.0.0.1:60242 - "OPTIONS /api/documents/upload HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:utils.storage:File ed242f95-708f-42cf-a7a7-4db9dc19a0ee.pdf saved to ./uploads/ed242f95-708f-42cf-a7a7-4db9dc19a0ee.pdf
INFO:     127.0.0.1:60242 - "POST /api/documents/upload HTTP/1.1" 200 OK
INFO:pdf_processing.document_service:Starting optimized processing of document ed242f95-708f-42cf-a7a7-4db9dc19a0ee (Bank_5Q_Trend_Report.pdf) with Claude Files API
INFO:pdf_processing.document_service:No cached file_id for document ed242f95-708f-42cf-a7a7-4db9dc19a0ee, performing full processing
INFO:pdf_processing.api_service:Processing PDF: Bank_5Q_Trend_Report.pdf with Claude API using native PDF support.
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/files "HTTP/1.1 200 OK"
INFO:utils.file_cache:Cached file_id=file_011CQL9D7CyExuH7izFBSXQs for content hash=9c15100a12f1a9ad... (expires: 2025-09-18 15:57:27, cache size: 1)
INFO:audit.pdf_access:PDF_ACCESS: {'timestamp': 'AUTO', 'operation': 'upload', 'file_id': 'file_011CQL9D7CyExuH7izFBSXQs', 'user_context': 'system', 'file_size_bytes': 29802, 'privacy_note': 'PDF content not logged for compliance'}
INFO:pdf_processing.claude_file_client:Uploaded Bank_5Q_Trend_Report.pdf (0.0 MB) ‚Üí file_011CQL9D7CyExuH7izFBSXQs
INFO:pdf_processing.api_service:Generated Claude file_id file_011CQL9D7CyExuH7izFBSXQs for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Analyzing document type for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Analyzing document type for Bank_5Q_Trend_Report.pdf using file_id=file_011CQL9D7CyExuH7izFBSXQs
INFO:pdf_processing.model_router:Using Haiku for light tools set() with 1000 tokens (haiku_calls=1, sonnet_calls=0)
INFO:pdf_processing.api_service:Model router selected claude-3-5-haiku-20241022 for document type analysis
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (non-streaming): 117 (Custom estimate: 117)
INFO:pdf_processing.api_service:Throttling based on token count: 117 (SDK count: 117, Custom estimate: 117)
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
WARNING:pdf_processing.api_service:Invalid document type 'integrated_financial_statements', using OTHER
INFO:pdf_processing.api_service:Document Bank_5Q_Trend_Report.pdf classified as other with periods: ['2024Q1', '2024Q2', '2024Q3', '2024Q4', '2025Q1']
INFO:pdf_processing.api_service:Document Bank_5Q_Trend_Report.pdf classified as: other with periods: ['2024Q1', '2024Q2', '2024Q3', '2024Q4', '2025Q1']
INFO:pdf_processing.api_service:Extracting structured financial data and citations for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Extracting structured financial data with citations from: Bank_5Q_Trend_Report.pdf using file_id file_011CQL9D7CyExuH7izFBSXQs
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (non-streaming): 177 (Custom estimate: 101)
INFO:pdf_processing.api_service:Throttling based on token count: 177 (SDK count: 177, Custom estimate: 101)
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Successfully parsed financial JSON from Claude's response.
INFO:pdf_processing.api_service:Captured Claude's preamble text, length: 102
INFO:pdf_processing.api_service:Extracted 0 citations for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Structured financial data keys for Bank_5Q_Trend_Report.pdf: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json']
INFO:pdf_processing.api_service:Added claude_file_id file_011CQL9D7CyExuH7izFBSXQs to extracted_data for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.document_service:Processed document using Files API: PDF Bank_5Q_Trend_Report.pdf processed using Claude's native PDF support via Files API
INFO:pdf_processing.document_service:Extracted claude_file_id file_011CQL9D7CyExuH7izFBSXQs from processed document data
INFO:pdf_processing.document_service:Stored claude_file_id file_011CQL9D7CyExuH7izFBSXQs in database for document ed242f95-708f-42cf-a7a7-4db9dc19a0ee
INFO:pdf_processing.document_service:Updating document ed242f95-708f-42cf-a7a7-4db9dc19a0ee content with Claude optimizations using Files API
INFO:pdf_processing.document_service:Document ed242f95-708f-42cf-a7a7-4db9dc19a0ee processed with Claude optimizations. File ID: file_011CQL9D7CyExuH7izFBSXQs
INFO:pdf_processing.document_service:Storing 0 citations for document ed242f95-708f-42cf-a7a7-4db9dc19a0ee
INFO:pdf_processing.document_service:Successfully completed optimized processing for document ed242f95-708f-42cf-a7a7-4db9dc19a0ee
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Document ed242f95-708f-42cf-a7a7-4db9dc19a0ee accepted for financial analysis
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee/check-financial-data HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Document ed242f95-708f-42cf-a7a7-4db9dc19a0ee accepted for financial analysis
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee/check-financial-data HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "OPTIONS /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee/verify-financial-data HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Document ed242f95-708f-42cf-a7a7-4db9dc19a0ee has extracted_data with keys: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json', 'claude_file_id']
INFO:     127.0.0.1:60242 - "POST /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee/verify-financial-data HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:     127.0.0.1:60242 - "OPTIONS /api/conversation/f7fd8219-d96d-4bfc-872e-27ae595a514e/document/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     127.0.0.1:60242 - "POST /api/conversation/f7fd8219-d96d-4bfc-872e-27ae595a514e/document/ed242f95-708f-42cf-a7a7-4db9dc19a0ee HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Retrieving file for document: ed242f95-708f-42cf-a7a7-4db9dc19a0ee
INFO:app.routes.document:Returning binary PDF data for document ed242f95-708f-42cf-a7a7-4db9dc19a0ee, size: 29802 bytes
INFO:     127.0.0.1:60242 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee/file HTTP/1.1" 200 OK
INFO:     127.0.0.1:60247 - "GET /api/documents/ed242f95-708f-42cf-a7a7-4db9dc19a0ee/citations HTTP/1.1" 200 OK
INFO:app.routes.websocket:WEBSOCKET_FLOW: Sent message_start event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: Starting conversation processing for conversation: f7fd8219-d96d-4bfc-872e-27ae595a514e
ERROR:sqlalchemy.pool.impl.NullPool:The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-46, started daemon 6215168000)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
sys:1: SAWarning: The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-46, started daemon 6215168000)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
INFO:repositories.document_repository:Retrieving document content using file path: ed242f95-708f-42cf-a7a7-4db9dc19a0ee.pdf
INFO:repositories.document_repository:Requesting file from storage service for document ed242f95-708f-42cf-a7a7-4db9dc19a0ee
INFO:repositories.document_repository:Retrieved PDF content for document ed242f95-708f-42cf-a7a7-4db9dc19a0ee: 29802 bytes
INFO:repositories.document_repository:Document ed242f95-708f-42cf-a7a7-4db9dc19a0ee has claude_file_id: file_011CQL9D7CyExuH7izFBSXQs (native PDF support available)
INFO:repositories.document_repository:PDF document ed242f95-708f-42cf-a7a7-4db9dc19a0ee uses claude_file_id for native support - raw_text not required
INFO:repositories.document_repository:Extracted data available for document ed242f95-708f-42cf-a7a7-4db9dc19a0ee: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json', 'claude_file_id']
INFO:repositories.document_repository:Successfully retrieved content for document ed242f95-708f-42cf-a7a7-4db9dc19a0ee
INFO:services.conversation_service:Retrieved content for document ed242f95-708f-42cf-a7a7-4db9dc19a0ee: content size=29802, raw_text size=0
INFO:services.conversation_service:Document ed242f95-708f-42cf-a7a7-4db9dc19a0ee available content types: content, extracted_data
INFO:services.conversation_service:Added document ed242f95-708f-42cf-a7a7-4db9dc19a0ee to context for conversation f7fd8219-d96d-4bfc-872e-27ae595a514e
INFO:repositories.document_repository:Retrieving document content using file path: ed242f95-708f-42cf-a7a7-4db9dc19a0ee.pdf
INFO:repositories.document_repository:Requesting file from storage service for document ed242f95-708f-42cf-a7a7-4db9dc19a0ee
INFO:repositories.document_repository:Retrieved PDF content for document ed242f95-708f-42cf-a7a7-4db9dc19a0ee: 29802 bytes
INFO:repositories.document_repository:Document ed242f95-708f-42cf-a7a7-4db9dc19a0ee has claude_file_id: file_011CQL9D7CyExuH7izFBSXQs (native PDF support available)
INFO:repositories.document_repository:PDF document ed242f95-708f-42cf-a7a7-4db9dc19a0ee uses claude_file_id for native support - raw_text not required
INFO:repositories.document_repository:Extracted data available for document ed242f95-708f-42cf-a7a7-4db9dc19a0ee: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json', 'claude_file_id']
INFO:repositories.document_repository:Successfully retrieved content for document ed242f95-708f-42cf-a7a7-4db9dc19a0ee
INFO:services.conversation_service:Added document ed242f95-708f-42cf-a7a7-4db9dc19a0ee with Files API file_id: file_011CQL9D7CyExuH7izFBSXQs
INFO:services.conversation_service:Using unified streaming approach with tools available for conversation f7fd8219-d96d-4bfc-872e-27ae595a514e
INFO:services.conversation_service:Using Files API claude_file_id file_011CQL9D7CyExuH7izFBSXQs for unified streaming analysis
INFO:pdf_processing.api_service:Starting streaming analyze_with_visualization_tools for query: 'How have deposits performed?...'
INFO:pdf_processing.api_service:Streaming visualization analysis turn 1/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_graph_data', 'generate_table_data', 'generate_comparative_period', 'generate_financial_metric'} with 47 tokens (haiku_calls=1, sonnet_calls=1)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 4321 (Custom estimate: 40)
INFO:pdf_processing.api_service:Throttling based on token count: 4321 (SDK count: 4321, Custom estimate: 40)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting message_start event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 3 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 3
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 3 chars
INFO:services.conversation_service:üìù Content updated: 3 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 3 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 71 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 71
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 71 chars
INFO:services.conversation_service:üìù Content updated: 71 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 71 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 96 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 96
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 96 chars
INFO:services.conversation_service:üìù Content updated: 96 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 96 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 120 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 120
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 120 chars
INFO:services.conversation_service:üìù Content updated: 120 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 120 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 158 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 158
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 158 chars
INFO:services.conversation_service:üìù Content updated: 158 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 158 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 181 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 181
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 181 chars
INFO:services.conversation_service:üìù Content updated: 181 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 181 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 188 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 188
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 188 chars
INFO:services.conversation_service:üìù Content updated: 188 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 188 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 201 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 201
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 201 chars
INFO:services.conversation_service:üìù Content updated: 201 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 201 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 230 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 230
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 230 chars
INFO:services.conversation_service:üìù Content updated: 230 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 230 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 259 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 259
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 259 chars
INFO:services.conversation_service:üìù Content updated: 259 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 259 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 271 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 271
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 271 chars
INFO:services.conversation_service:üìù Content updated: 271 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 271 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 280 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 280
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 280 chars
INFO:services.conversation_service:üìù Content updated: 280 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 280 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 288 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 288
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 288 chars
INFO:services.conversation_service:üìù Content updated: 288 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 288 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 305 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 305
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 305 chars
INFO:services.conversation_service:üìù Content updated: 305 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 305 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 324 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 324
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 324 chars
INFO:services.conversation_service:üìù Content updated: 324 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 324 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 330 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 330
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 330 chars
INFO:services.conversation_service:üìù Content updated: 330 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 330 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 354 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 354
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 354 chars
INFO:services.conversation_service:üìù Content updated: 354 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 354 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 370 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 370
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 370 chars
INFO:services.conversation_service:üìù Content updated: 370 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 370 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 385 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 385
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 385 chars
INFO:services.conversation_service:üìù Content updated: 385 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 385 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 400 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 400
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 400 chars
INFO:services.conversation_service:üìù Content updated: 400 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 400 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 427 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 427
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 427 chars
INFO:services.conversation_service:üìù Content updated: 427 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 427 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 450 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 450
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 450 chars
INFO:services.conversation_service:üìù Content updated: 450 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 450 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 483 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 483
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 483 chars
INFO:services.conversation_service:üìù Content updated: 483 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 483 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 500 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 500
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 500 chars
INFO:services.conversation_service:üìù Content updated: 500 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 500 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 505 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 505
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 505 chars
INFO:services.conversation_service:üìù Content updated: 505 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 505 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 513 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 513
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 513 chars
INFO:services.conversation_service:üìù Content updated: 513 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 513 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 522 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 522
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 522 chars
INFO:services.conversation_service:üìù Content updated: 522 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 522 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 527 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 527
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 527 chars
INFO:services.conversation_service:üìù Content updated: 527 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 527 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 536 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 536
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 536 chars
INFO:services.conversation_service:üìù Content updated: 536 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 536 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 566 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 566
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 566 chars
INFO:services.conversation_service:üìù Content updated: 566 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 566 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 584 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 584
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 584 chars
INFO:services.conversation_service:üìù Content updated: 584 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 584 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 593 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 593
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 593 chars
INFO:services.conversation_service:üìù Content updated: 593 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 593 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 597 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 597
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 597 chars
INFO:services.conversation_service:üìù Content updated: 597 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 597 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 609 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 609
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 609 chars
INFO:services.conversation_service:üìù Content updated: 609 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 609 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 616 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 616
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 616 chars
INFO:services.conversation_service:üìù Content updated: 616 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 616 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 627 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 627
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 627 chars
INFO:services.conversation_service:üìù Content updated: 627 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 627 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 636 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 636
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 636 chars
INFO:services.conversation_service:üìù Content updated: 636 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 636 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 660 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 660
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 660 chars
INFO:services.conversation_service:üìù Content updated: 660 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 660 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 684 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 684
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 684 chars
INFO:services.conversation_service:üìù Content updated: 684 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 684 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 688 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 688
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 688 chars
INFO:services.conversation_service:üìù Content updated: 688 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 688 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 697 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 697
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 697 chars
INFO:services.conversation_service:üìù Content updated: 697 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 697 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 708 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 708
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 708 chars
INFO:services.conversation_service:üìù Content updated: 708 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 708 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 718 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 718
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 718 chars
INFO:services.conversation_service:üìù Content updated: 718 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 718 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 751 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 751
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 751 chars
INFO:services.conversation_service:üìù Content updated: 751 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 751 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 773 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 773
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 773 chars
INFO:services.conversation_service:üìù Content updated: 773 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 773 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 781 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 781
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 781 chars
INFO:services.conversation_service:üìù Content updated: 781 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 781 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 788 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 788
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 788 chars
INFO:services.conversation_service:üìù Content updated: 788 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 788 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 794 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 794
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 794 chars
INFO:services.conversation_service:üìù Content updated: 794 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 794 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 815 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 815
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 815 chars
INFO:services.conversation_service:üìù Content updated: 815 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 815 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 830 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 830
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 830 chars
INFO:services.conversation_service:üìù Content updated: 830 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 830 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 842 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 842
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 842 chars
INFO:services.conversation_service:üìù Content updated: 842 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 842 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 851 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 851
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 851 chars
INFO:services.conversation_service:üìù Content updated: 851 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 851 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 904 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 904
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 904 chars
INFO:services.conversation_service:üìù Content updated: 904 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 904 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 918 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 918
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 918 chars
INFO:services.conversation_service:üìù Content updated: 918 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 918 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_start event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_start - tool_id=toolu_0128yjBkDSGQYpdi3MCzKqKW, tool_name=generate_graph_data
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_graph_data: type=<class 'dict'>
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: msg_01JhLmVHMqpB4NJFudeAQh95
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_0128yjBkDSGQYpdi3MCzKqKW, tool_name=generate_graph_data
INFO:pdf_processing.api_service:Turn 1: Initial streaming text preserved (918 chars)
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_graph_data (ID: toolu_0128yjBkDSGQYpdi3MCzKqKW)
INFO:pdf_processing.api_service:Processing streaming tool generate_graph_data (ID: toolu_0128yjBkDSGQYpdi3MCzKqKW)
INFO:pdf_processing.api_service:Tool generate_graph_data (ID: toolu_0128yjBkDSGQYpdi3MCzKqKW) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_graph_data (ID: toolu_0128yjBkDSGQYpdi3MCzKqKW) - dict input keys: ['chartType', 'config', 'data', 'chartConfig']
INFO:utils.tool_processing:Processing generate_graph_data (ID: toolu_0128yjBkDSGQYpdi3MCzKqKW) - input type: <class 'dict'>
INFO:utils.tool_processing:Starting process_chart_input with input type: <class 'dict'>
INFO:utils.tool_processing:Chart input keys: ['chartType', 'config', 'data', 'chartConfig']
INFO:utils.tool_processing:Chart config type: <class 'str'>
INFO:utils.tool_processing:Chart data type: <class 'list'>, length: 5
INFO:utils.tool_processing:Chart chartConfig type: <class 'dict'>
WARNING:utils.tool_processing:Chart config is a JSON string, parsing it
INFO:utils.tool_processing:Successfully parsed config JSON string
INFO:utils.tool_processing:Chart config keys: ['title', 'xAxisKey', 'yAxisLabel', 'description']
INFO:utils.tool_processing:Successfully got original_data: type=<class 'list'>
INFO:utils.tool_processing:Chart type: line
INFO:utils.tool_processing:Chart config settings type: <class 'dict'>
INFO:utils.tool_processing:x_axis_key: period
INFO:utils.tool_processing:Transforming chart data to {x, y} format required by ChartDataItem model
INFO:utils.tool_processing:Transformed 5 items for single series line chart using value_key='deposits'
INFO:utils.tool_processing:Successfully processed chart: Total Deposits Trend
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_0128yjBkDSGQYpdi3MCzKqKW, tool_name=generate_graph_data
INFO:pdf_processing.api_service:Streaming visualization analysis turn 2/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_graph_data', 'generate_table_data', 'generate_comparative_period', 'generate_financial_metric'} with 635 tokens (haiku_calls=1, sonnet_calls=2)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 5096 (Custom estimate: 270)
INFO:pdf_processing.api_service:Throttling based on token count: 5096 (SDK count: 5096, Custom estimate: 270)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting message_start event with message_id: msg_01NvK6dAdXVGWWeHyegxmkMg
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_start event with message_id: msg_01NvK6dAdXVGWWeHyegxmkMg
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_start - tool_id=toolu_01XYqBGcAVtTVGuaDiMjoQZV, tool_name=generate_table_data
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_table_data: type=<class 'dict'>
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: msg_01NvK6dAdXVGWWeHyegxmkMg
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01XYqBGcAVtTVGuaDiMjoQZV, tool_name=generate_table_data
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_table_data (ID: toolu_01XYqBGcAVtTVGuaDiMjoQZV)
INFO:pdf_processing.api_service:Processing streaming tool generate_table_data (ID: toolu_01XYqBGcAVtTVGuaDiMjoQZV)
INFO:pdf_processing.api_service:Tool generate_table_data (ID: toolu_01XYqBGcAVtTVGuaDiMjoQZV) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_table_data (ID: toolu_01XYqBGcAVtTVGuaDiMjoQZV) - dict input keys: ['tableType', 'config', 'data']
INFO:utils.tool_processing:Processing generate_table_data (ID: toolu_01XYqBGcAVtTVGuaDiMjoQZV) - input type: <class 'dict'>
INFO:utils.tool_processing:Starting process_table_input with input type: <class 'dict'>
INFO:utils.tool_processing:Table input keys: ['tableType', 'config', 'data']
INFO:utils.tool_processing:Table config type: <class 'str'>
INFO:utils.tool_processing:Table data type: <class 'list'>, length: 5
WARNING:utils.tool_processing:Table config is a JSON string, parsing it
INFO:utils.tool_processing:Successfully parsed table config JSON string
INFO:utils.tool_processing:Successfully processed table: Deposit Composition Analysis
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01XYqBGcAVtTVGuaDiMjoQZV, tool_name=generate_table_data
INFO:pdf_processing.api_service:Streaming visualization analysis turn 3/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_graph_data', 'generate_table_data', 'generate_comparative_period', 'generate_financial_metric'} with 1299 tokens (haiku_calls=1, sonnet_calls=3)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 6157 (Custom estimate: 270)
INFO:pdf_processing.api_service:Throttling based on token count: 6157 (SDK count: 6157, Custom estimate: 270)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting message_start event with message_id: msg_018Gepwa4wGYgYcBf1R7ZEAe
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_start event with message_id: msg_018Gepwa4wGYgYcBf1R7ZEAe
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_start - tool_id=toolu_01YcE2tTGpVwYZgF2FBNLD9E, tool_name=generate_financial_metric
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_financial_metric: type=<class 'dict'>
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: msg_018Gepwa4wGYgYcBf1R7ZEAe
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01YcE2tTGpVwYZgF2FBNLD9E, tool_name=generate_financial_metric
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_financial_metric (ID: toolu_01YcE2tTGpVwYZgF2FBNLD9E)
INFO:pdf_processing.api_service:Processing streaming tool generate_financial_metric (ID: toolu_01YcE2tTGpVwYZgF2FBNLD9E)
INFO:pdf_processing.api_service:Tool generate_financial_metric (ID: toolu_01YcE2tTGpVwYZgF2FBNLD9E) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_financial_metric (ID: toolu_01YcE2tTGpVwYZgF2FBNLD9E) - dict input keys: ['category', 'name', 'period', 'value', 'unit', 'isEstimated']
INFO:utils.tool_processing:Processing generate_financial_metric (ID: toolu_01YcE2tTGpVwYZgF2FBNLD9E) - input type: <class 'dict'>
INFO:utils.tool_processing:Successfully processed financial metric: Total Deposit Growth Rate (Annualized)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01YcE2tTGpVwYZgF2FBNLD9E, tool_name=generate_financial_metric
INFO:pdf_processing.api_service:Streaming visualization analysis turn 4/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_graph_data', 'generate_table_data', 'generate_comparative_period', 'generate_financial_metric'} with 1424 tokens (haiku_calls=1, sonnet_calls=4)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 6388 (Custom estimate: 270)
INFO:pdf_processing.api_service:Throttling based on token count: 6388 (SDK count: 6388, Custom estimate: 270)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting message_start event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 3 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 3
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 3 chars
INFO:services.conversation_service:üìù Content updated: 3 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 3 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 45 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 45
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 45 chars
INFO:services.conversation_service:üìù Content updated: 45 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 45 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 50 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 50
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 50 chars
INFO:services.conversation_service:üìù Content updated: 50 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 50 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 78 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 78
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 78 chars
INFO:services.conversation_service:üìù Content updated: 78 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 78 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 99 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 99
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 99 chars
INFO:services.conversation_service:üìù Content updated: 99 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 99 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 117 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 117
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 117 chars
INFO:services.conversation_service:üìù Content updated: 117 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 117 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 136 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 136
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 136 chars
INFO:services.conversation_service:üìù Content updated: 136 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 136 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 164 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 164
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 164 chars
INFO:services.conversation_service:üìù Content updated: 164 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 164 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 176 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 176
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 176 chars
INFO:services.conversation_service:üìù Content updated: 176 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 176 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 194 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 194
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 194 chars
INFO:services.conversation_service:üìù Content updated: 194 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 194 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 223 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 223
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 223 chars
INFO:services.conversation_service:üìù Content updated: 223 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 223 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 256 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 256
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 256 chars
INFO:services.conversation_service:üìù Content updated: 256 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 256 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 283 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 283
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 283 chars
INFO:services.conversation_service:üìù Content updated: 283 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 283 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 304 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 304
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 304 chars
INFO:services.conversation_service:üìù Content updated: 304 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 304 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 344 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 344
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 344 chars
INFO:services.conversation_service:üìù Content updated: 344 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 344 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 352 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 352
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 352 chars
INFO:services.conversation_service:üìù Content updated: 352 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 352 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 365 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 365
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 365 chars
INFO:services.conversation_service:üìù Content updated: 365 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 365 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 397 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 397
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 397 chars
INFO:services.conversation_service:üìù Content updated: 397 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 397 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 419 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 419
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 419 chars
INFO:services.conversation_service:üìù Content updated: 419 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 419 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 475 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 475
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 475 chars
INFO:services.conversation_service:üìù Content updated: 475 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 475 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 503 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 503
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 503 chars
INFO:services.conversation_service:üìù Content updated: 503 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 503 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 533 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 533
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 533 chars
INFO:services.conversation_service:üìù Content updated: 533 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 533 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 559 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 559
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 559 chars
INFO:services.conversation_service:üìù Content updated: 559 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 559 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 574 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 574
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 574 chars
INFO:services.conversation_service:üìù Content updated: 574 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 574 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 600 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 600
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 600 chars
INFO:services.conversation_service:üìù Content updated: 600 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 600 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 635 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 635
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 635 chars
INFO:services.conversation_service:üìù Content updated: 635 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 635 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 670 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 670
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 670 chars
INFO:services.conversation_service:üìù Content updated: 670 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 670 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 704 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 704
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 704 chars
INFO:services.conversation_service:üìù Content updated: 704 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 704 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 736 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 736
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 736 chars
INFO:services.conversation_service:üìù Content updated: 736 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 736 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 773 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 773
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 773 chars
INFO:services.conversation_service:üìù Content updated: 773 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 773 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 820 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 820
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 820 chars
INFO:services.conversation_service:üìù Content updated: 820 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 820 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 867 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 867
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 867 chars
INFO:services.conversation_service:üìù Content updated: 867 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 867 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 908 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 908
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 908 chars
INFO:services.conversation_service:üìù Content updated: 908 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 908 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 956 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 956
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 956 chars
INFO:services.conversation_service:üìù Content updated: 956 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 956 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 985 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 985
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 985 chars
INFO:services.conversation_service:üìù Content updated: 985 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 985 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014XvWGM2HJqUgwFMj7dYHiG
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 992 chars
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 992
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 992 chars
INFO:services.conversation_service:üìù Content updated: 992 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 992 chars
INFO:pdf_processing.api_service:Turn 4: Adding new content (992 chars)
INFO:pdf_processing.api_service:Streaming visualization analysis completed: no more tools
INFO:pdf_processing.api_service:Streaming visualization analysis completed: 1 charts, 1 tables, 1 metrics. Analysis text length: 1912
INFO:services.conversation_service:Current assistant message content length: 992
INFO:services.conversation_service:Analysis text length: 1912
INFO:services.conversation_service:üìù Using streaming content (992 chars)
INFO:repositories.conversation_repository:Updated and re-fetched message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
INFO:repositories.conversation_repository:Message content length: 992
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 992 chars
INFO:services.conversation_service:‚úÖ Database updated with final content: 992 chars
INFO:services.conversation_service:Sent message_update event for ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c after streaming complete
INFO:services.conversation_service:DEBUG: result.get('metrics'): [{'category': 'Deposits', 'name': 'Total Deposit Growth Rate (Annualized)', 'period': '2024Q1-2025Q1', 'value': 3.7, 'unit': '%', 'isEstimated': False}]
INFO:services.conversation_service:DEBUG: accumulated_metrics: [{'category': 'Deposits', 'name': 'Total Deposit Growth Rate (Annualized)', 'period': '2024Q1-2025Q1', 'value': 3.7, 'unit': '%', 'isEstimated': False}]
INFO:services.conversation_service:Processing visualizations for conversation f7fd8219-d96d-4bfc-872e-27ae595a514e: charts=1, tables=1, metrics=1
INFO:services.conversation_service:Processing chart: Total Deposits Trend
INFO:services.conversation_service:Processing table: Deposit Composition Analysis
INFO:services.conversation_service:Processing metric: Total Deposit Growth Rate (Annualized)
INFO:services.conversation_service:Storing 3 analysis blocks for streaming message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c
ERROR:app.routes.websocket:WEBSOCKET_FLOW: Error handling streaming message ec0a4bc5-d1e4-4918-a23e-c219ffb22e8c: A transaction is already begun on this Session.
Traceback (most recent call last):
  File "/Users/alexcardell/AlexCoding_Local/cfin/backend/app/routes/websocket.py", line 256, in handle_streaming_message
    result = await conversation_service.process_user_message_streaming(
  File "/Users/alexcardell/AlexCoding_Local/cfin/backend/services/conversation_service.py", line 1092, in process_user_message_streaming
    await self._store_analysis_blocks_atomically(
  File "/Users/alexcardell/AlexCoding_Local/cfin/backend/services/conversation_service.py", line 1833, in _store_analysis_blocks_atomically
    async with self.conversation_repository.db.begin() as transaction:
  File "/Users/alexcardell/AlexCoding_Local/venv/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/base.py", line 125, in __aenter__
    return await self.start(is_ctxmanager=True)
  File "/Users/alexcardell/AlexCoding_Local/venv/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py", line 1869, in start
    await greenlet_spawn(
  File "/Users/alexcardell/AlexCoding_Local/venv/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 179, in greenlet_spawn
    result = context.switch(*args, **kwargs)
  File "/Users/alexcardell/AlexCoding_Local/venv/lib/python3.9/site-packages/sqlalchemy/orm/session.py", line 1880, in begin
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: A transaction is already begun on this Session.
ERROR:app.routes.websocket:WEBSOCKET_FLOW: Conversation f7fd8219-d96d-4bfc-872e-27ae595a514e processing failed
</Backend_Logs>