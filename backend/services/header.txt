"""
Conversation Service Module
==========================

This module provides the service layer for managing conversations and messages in the CFIN financial 
analysis platform. It handles the logic for creating conversations, processing user messages, 
generating AI responses using Claude, and managing document-based Q&A with citations.

Primary responsibilities:
- Create and manage conversations between users and the AI assistant
- Process user messages and generate context-aware responses
- Integrate document content into conversations for document-based Q&A
- Manage citations and document references in AI responses
- Support visualization generation for financial analysis requests
- Decide on the appropriate processing approach for different types of queries

Key Components:
- ConversationService: Main service class for conversation management and message processing
- Methods for building prompts, processing responses, and managing conversation context

Interactions with other files:
-----------------------------
1. cfin/backend/repositories/conversation_repository.py:
   - Uses ConversationRepository for database operations on conversations and messages
   - Methods used: create_conversation, add_message, get_conversation_messages, etc.
   - Handles persistence of conversation data

2. cfin/backend/repositories/document_repository.py:
   - Uses DocumentRepository to access document content for Q&A
   - Methods used: get_document_content, get_document, get_citation
   - Retrieves document text and binary content for analysis

3. cfin/backend/repositories/analysis_repository.py:
   - Uses AnalysisRepository to store and retrieve analysis results
   - Manages persistence of financial analysis visualizations

4. cfin/backend/pdf_processing/claude_service.py:
   - Uses ClaudeService for AI response generation and document analysis
   - Methods used: generate_response, process_pdf, extract_structured_financial_data
   - Primary interface for Claude AI capabilities

5. cfin/backend/models/database_models.py:
   - Uses Message, Conversation, Document, Citation, AnalysisBlock, User models
   - These define the database structure for conversation-related entities
   
6. cfin/backend/pdf_processing/langgraph_service.py:
   - Indirectly uses LangGraphService through ClaudeService
   - Used for document-based Q&A with citations in the _process_with_langgraph method

The conversation service orchestrates the user-AI interaction flow, connecting the repository 
layer with the AI processing capabilities. It's responsible for maintaining conversation 
context and ensuring that document references and citations are properly integrated into 
the AI responses.
"""

