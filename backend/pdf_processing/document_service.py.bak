"""\nDocument Service Module\n=====================\n\nThis module provides the service layer for document operations in the CFIN financial\nanalysis platform. It handles the processing of uploaded documents, extraction of\nfinancial data using Claude AI, and management of document content and citations.\n\nPrimary responsibilities:\n- Process uploaded PDF documents using Claude AI\n- Extract structured financial data and text content from PDFs\n- Store document content and citations in the database\n- Manage document metadata and processing status\n- Provide interfaces for retrieving document content for analysis\n\nKey Components:\n- DocumentService: Main service class for document processing operations\n- _process_document: Asynchronous method for background document processing\n- Methods for retrieving and analyzing document content\n\nInteractions with other files:\n-----------------------------\n1. cfin/backend/repositories/document_repository.py:\n   - Uses DocumentRepository for database operations on documents\n   - Methods used: create_document, update_document_status, update_document_content, add_citation\n   - Handles persistence of document data and citations\n\n2. cfin/backend/pdf_processing/claude_service.py:\n   - Uses ClaudeService for PDF processing and AI analysis\n   - Methods used: process_pdf, extract_structured_financial_data\n   - Performs the actual AI-powered document analysis\n\n3. cfin/backend/pdf_processing/enhanced_pdf_service.py:\n   - Uses EnhancedPDFService for additional PDF processing capabilities\n   - Provides fallback mechanisms for PDF handling\n\n4. cfin/backend/pdf_processing/langgraph_service.py:\n   - Interacts indirectly via ClaudeService for document Q&A\n   - Used for citation-rich document analysis\n\n5. cfin/backend/models/document.py:\n   - Uses ProcessedDocument, DocumentMetadata, ProcessingStatus, DocumentContentType, Citation models\n   - These Pydantic models define the API schemas for documents and citations\n\n6. cfin/backend/models/database_models.py:\n   - Uses DocumentType, ProcessingStatusEnum, Document, Citation database models\n   - These models define the database schema for documents\n\n7. cfin/backend/services/conversation_service.py:\n   - ConversationService uses this service via repositories to access document content\n   - Integrates document content into conversations\n\nThis service acts as the orchestrator for document processing and analysis,\ncoordinating between the repository layer (for persistence) and the AI services\n(for document understanding). It ensures documents are properly processed and\nstored with all the necessary metadata and content for downstream analysis.\n"""\n\nimport os\nimport uuid\nimport json\nimport logging\nfrom datetime import datetime\nfrom typing import Dict, List, Optional, BinaryIO, Any\nfrom pathlib import Path\nimport asyncio\n\nfrom models.document import (\n    ProcessedDocument, \n    DocumentMetadata, \n    ProcessingStatus,\n    DocumentContentType,\n    Citation as CitationSchema,\n    DocumentUploadResponse\n)\nfrom models.database_models import DocumentType, ProcessingStatusEnum, Document, Citation\nfrom pdf_processing.claude_service import ClaudeService\nfrom pdf_processing.enhanced_pdf_service import EnhancedPDFService\nfrom repositories.document_repository import DocumentRepository