# Sprint Tasks: Migrate Mock Analysis and Visualization Features to NextJS Frontend

## Topic 1:  Core Analysis Canvas and Display

This topic focuses on bringing the core analysis display functionality from the old Vite frontend to the new NextJS frontend.


1.  [x] **Story 1: Implement Basic Analysis Canvas Structure**
    *   **Tasks:**
        1.  [x] Create a new `Canvas.tsx` component in `src/components/visualization/` within the `nextjs-fdas` project.
        2.  [x] Implement the basic layout structure for the analysis canvas, mirroring the layout from `Vite_Old/src/components/Canvas.tsx`. This should include:
            *   A container for analysis blocks.
            *   Basic placeholder UI for "No data to display" and "Error" states, similar to the existing `Canvas.tsx.bak` or the `Vite_Old/src/components/Canvas.tsx` if more complete.
        3.  [x] Ensure the component is placed within the 'Analysis' tab in `src/app/workspace/page.tsx`, conditionally rendering based on the active tab state.
        4.  [x] Connect the `Canvas` component to the `analysisResults` state (even if it's mock data for now) passed down from the `Workspace` page, similar to how `Vite_Old/src/components/Canvas.tsx` receives `analysisResults`.

2.  [x] **Story 2: Migrate Analysis Block Component**
    *   **Tasks:**
        1.  [x] Create a new `AnalysisBlock.tsx` component in `src/components/analysis/` in the `nextjs-fdas` project.
        2.  [x] Copy the code and styles from `Vite_Old/src/components/AnalysisBlock.tsx` into the new `AnalysisBlock.tsx` component.
        3.  [x] Ensure all necessary imports (icons, types) are correctly adjusted for the NextJS project structure.
        4.  [x] Update the `Canvas.tsx` component to use the new `AnalysisBlock` component to render each analysis block from the `analysisResults` data.

3.  [x] **Story 3: Migrate Enhanced Chart Component**
    *   **Tasks:**
        1.  [x] Create a new `EnhancedChart.tsx` component in `src/components/visualization/` in the `nextjs-fdas` project.
        2.  [x] Copy the code and styles from `Vite_Old/src/components/EnhancedChart.tsx` into the new `EnhancedChart.tsx` component.
        3.  [x] Adjust imports and ensure compatibility with NextJS (e.g., for Recharts, ensure it's client-side rendered if necessary).
        4.  [x] Update the `AnalysisBlock.tsx` component to use the `EnhancedChart` component for rendering charts, passing down the `chartData`, `chartType`, `onDataPointClick`, `insightData`, and `trendData` props from the `block` prop.

## Topic 2:  Implement Mock Analysis Data and Basic Chart Display

This topic focuses on setting up mock data to display charts and analysis blocks within the NextJS frontend, allowing for visual testing.

4.  [x] **Story 4: Create Mock Analysis Data Service**
    *   **Tasks:**
        1.  [x] Create a new file `mockAnalysisData.ts` in `src/lib/` or `src/lib/api/`.
        2.  [x] Copy the relevant mock data generation functions from `Vite_Old/src/services/mockBackend.ts` and `Vite_Old/src/services/api.ts` (specifically `generateMockResponse`, `generateMockMetrics`, `generateMockRatios`, `mockGetChartData`, `mockGetEnhancedAnalysis`, `mockGetConversationAnalysis`, `generateMockCitations`) into `mockAnalysisData.ts`.
        3.  [x]  Adapt these functions to be usable in the NextJS environment, adjusting imports as necessary.
        4.  [x] Create a function in `mockAnalysisData.ts` to simulate fetching analysis results (similar to `apiService.runAnalysis` in `Vite_Old/src/services/api.ts`), returning mock data generated by the copied functions.

5.  [x] **Story 5: Integrate Mock Analysis Data into Canvas Component**
    *   **Tasks:**
        1.  [x]  In `src/app/workspace/page.tsx`, create a state variable (e.g., `mockAnalysisResults`) to hold mock analysis data.
        2.  [x]  Import the mock analysis data service created in Story 4.
        3.  [x]  Create a function (e.g., `runMockAnalysis`) that uses the mock analysis data service to generate mock `analysisResults`. This function can be triggered by a button or a simplified user interaction for testing.
        4.  [x]  Pass the `mockAnalysisResults` state variable to the `Canvas` component in `src/app/workspace/page.tsx`.
        5.  [x]  Verify that the `Canvas` component now displays mock analysis blocks and charts using the mock data.

## Topic 3:  Citation and PDF Highlighting Features

This topic focuses on migrating the citation and PDF highlighting features, ensuring seamless integration with the NextJS frontend.

6.  [x] **Story 6: Migrate PDFViewer Component**
    *   **Tasks:**
        1.  [x] Create a new `PDFViewer.tsx` component in `src/components/document/` in the `nextjs-fdas` project.
        2.  [x] Copy the code and styles from `Vite_Old/src/components/PDFViewer.tsx` into the new `PDFViewer.tsx` component.
        3.  [x]  Adapt imports, especially for `react-pdf-highlighter`, and ensure PDF.js setup is correctly configured for NextJS (dynamic import might be needed as already done in `nextjs-fdas/src/app/workspace/page.tsx`).
        4.  [x]  Integrate the `PDFViewer` component into the 'Document' tab within `src/app/workspace/page.tsx`, conditionally rendering it when a `selectedDocument` is available.
        5.  [x]  Pass the `selectedDocument` and `aiHighlights` props (even with mock data for now) to the `PDFViewer` component, similar to `Vite_Old/src/App.tsx`.

7.  [x] **Story 7: Migrate Citation Service and Utility Functions**
    *   **Tasks:**
        1.  [x] Create a new directory `src/lib/pdf/` and add `citationService.ts` inside it.
        2.  [x] Copy the `citationService.ts` file from `nextjs-fdas/src/lib/pdf/citationService.ts` - it seems you've already started this, ensure it is complete and correct based on `Vite_Old/src/services/api.ts` and `Vite_Old/src/types/citations.ts` and `Vite_Old/src/types/enhanced.ts` for data conversion logic.
        3.  [x] Create a new directory `src/lib/utils/` and add `utils.ts`.
        4.  [x] Copy relevant utility functions related to data formatting or manipulation from `Vite_Old/src/utils/` if any are needed for citations or chart data processing in NextJS.
        5.  [x] Ensure all components (`Canvas.tsx`, `AnalysisBlock.tsx`, `EnhancedChart.tsx`, `PDFViewer.tsx`, `ChatInterface.tsx`) correctly import and utilize these utility functions and services from the new locations in the NextJS project structure.

8.  [x] **Story 8: Integrate Citations into Chat Interface and Analysis Blocks**
    *   **Tasks:**
        1.  [x] In `src/components/chat/ChatInterface.tsx`, ensure the `MessageRenderer` component and citation click handling (`handleCitationClick`) logic are present and functional, mirroring the functionality in `Vite_Old/src/components/ChatInterface.tsx`.
        2.  [x] Connect the `onCitationClick` prop in `ChatInterface.tsx` to a handler in `src/app/workspace/page.tsx` that will set the `highlightId` state and trigger scrolling in the `PDFViewer` component.
        3.  [x] In `src/components/analysis/AnalysisBlock.tsx` and `src/components/visualization/EnhancedChart.tsx`, ensure the `CitationTooltip` and `onCitationClick` prop are correctly implemented to handle clicks on citations within analysis insights and chart data points, similar to `Vite_Old/src/components/AnalysisBlock.tsx` and `Vite_Old/src/components/EnhancedChart.tsx`.
        4.  [x] Verify that clicking on citations in both chat messages and analysis blocks correctly navigates to and highlights the corresponding text in the `PDFViewer` component.