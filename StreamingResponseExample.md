<Initial_Streaming_Response>
Let me provide a comprehensive analysis of the credit performance based on the financial documents.

The credit performance shows some concerning trends with gradually deteriorating metrics across multiple indicators, though the deterioration appears managed and orderly rather than severe:

1. Loan Growth and Quality:
- Total gross loans have grown steadily from $42,000M in 2024Q1 to $45,000M in 2025Q1, representing healthy growth of 7.1%
- However, this growth has been accompanied by increasing credit stress indicators

2. Credit Quality Indicators:
- Non-performing assets (NPAs) have increased consistently each quarter, from $350M to $390M
- The allowance for loan losses has grown from $350M to $390M, matching the NPA growth
- Net charge-offs have shown an upward trend, increasing from $25M to $32M quarterly
- Non-accrual loans have risen from $260M to $290M

3. Past Due and Problem Loans:
- 90+ days past due loans have increased from $120M to $135M
- Troubled Debt Restructuring (TDR) balances have grown modestly from $50M to $56M

Let me generate some visualizations to better illustrate these trends.

</Initial_Streaming_Response>

<Post_Visualization_Streaming_Response>

The line chart above shows the consistent upward trajectory across all loan categories, with C&I loans maintaining the largest share of the portfolio. The detailed table provides a clear view of the absolute and percentage changes from 2024Q1 to 2025Q1.
Key metrics to note:
		The Quarter-over-Quarter Loan Growth Rate reached 2.27% in 2025Q1
		The Non-Performing Assets Ratio stands at 0.87% in 2025Q1, indicating relatively stable credit quality
The overall trend suggests a healthy and growing loan portfolio with controlled credit risk metrics. The growth appears to be well-distributed across all major loan categories, with C&I loans leading the expansion in absolute terms. The steady increase in loan loss allowances and modest uptick in non-performing assets suggest appropriate risk management practices are in place as the portfolio grows.
The line chart above shows the consistent upward trajectory across all loan categories, with C&I loans maintaining the largest share of the portfolio. The detailed table provides a clear view of the absolute and percentage changes from 2024Q1 to 2025Q1. Key metrics to note: 1. The Quarter-over-Quarter Loan Growth Rate reached 2.27% in 2025Q1 2. The Non-Performing Assets Ratio stands at 0.87% in 2025Q1, indicating relatively stable credit quality The overall trend suggests a healthy and growing loan portfolio with controlled credit risk metrics. The growth appears to be well-distributed across all major loan categories, with C&I loans leading the expansion in absolute terms. The steady increase in loan loss allowances and modest uptick in non-performing assets suggest appropriate risk management practices are in place as the portfolio grows.

</Post_Visualization_Streaming_Response>


<JavaScript_Console_Output>
[Log] Upload progress: 100.00%, Stage: Document ready
[Log] Document verification completed: – {metadata: Object, contentType: "other", extractionTimestamp: "2025-06-20T04:03:13.421Z", …}
{metadata: Object, contentType: "other", extractionTimestamp: "2025-06-20T04:03:13.421Z", periods: ["2024Q1", "2024Q2", "2024Q3", "2024Q4", "2025Q1"], extractedData: Object, …}Object
[Log] Associating document b5bb1f8a-61a1-491c-b6a3-c916803c48fb with conversation ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d
[Log] Sending POST request to http://localhost:8000/api/conversation/ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d/document/b5bb1f8a-61a1-491c-b6a3-c916803c48fb
[Log] Document b5bb1f8a-61a1-491c-b6a3-c916803c48fb added to conversation ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d
[Log] Document successfully associated with conversation
[Log] [Fast Refresh] rebuilding
[Log] PDFViewer unmounting, cleaning up resources
[Log] Sending GET request to http://localhost:8000/api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb/citations
[Log] [Fast Refresh] done in 216ms
[Log] Deprecated API usage: The `enhanceTextSelection` functionality will be removed in the future. (x2)
[Error] Source Map loading errors (x2)
[Error] Failed to load resource: the server responded with a status of 404 (Not Found) (types.js.map, line 0)
[Error] Failed to load resource: the server responded with a status of 404 (Not Found) (types.js.map, line 0)
[Log] Deprecated API usage: The `enhanceTextSelection` functionality will be removed in the future.
[Log] Submit conditions: useStreaming=true, conversationId=ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d, isConnected=true
[Log] Using WebSocket streaming for message submission
[Log] Message complete for null, fetching complete message from database
[Log] HTTP fallback: Message complete for bb3ce72a-5f9c-44f6-810b-f3a6776da24e, fetching from database
[Log] Sending GET request to http://localhost:8000/api/conversation/message/bb3ce72a-5f9c-44f6-810b-f3a6776da24e
[Log] Received HTTP message with 0 analysis blocks
[Log] Streaming message update: – {id: "bb3ce72a-5f9c-44f6-810b-f3a6776da24e", sessionId: "ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d", timestamp: "2025-06-20T04:04:37.971070Z", …}
{id: "bb3ce72a-5f9c-44f6-810b-f3a6776da24e", sessionId: "ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d", timestamp: "2025-06-20T04:04:37.971070Z", role: "assistant", content: "The line chart above shows the consistent upward t…nt practices are in place as the portfolio grows.", …}Object
[Log] Sending POST request to http://localhost:8000/api/conversation/ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d/generate-followups?limit=3
[Log] Sending POST request to http://localhost:8000/api/conversation/ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d/generate-followups?limit=3
[Log] Generated 3 follow-up questions for conversation ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d (x2)
[Log] Checking 3 messages for cumulative visualization data...
[Log] Examining assistant message 2: – "ID: bb3ce72a-5f9c-44f6-810b-f3a6776da24e" – "Has 4 analysis blocks"
[Log] Found 4 analysis blocks in message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
[Log] Analysis blocks structure: – "{↵  \"id\": \"8eff717a-c23b-4bc8-9f89-717f39da9df2\",↵  \"block_type\": \"chart\",↵  \"title\": \"Loan Portfolio Composition Trends\",↵  \"content\": {↵…"
"{
  \"id\": \"8eff717a-c23b-4bc8-9f89-717f39da9df2\",
  \"block_type\": \"chart\",
  \"title\": \"Loan Portfolio Composition Trends\",
  \"content\": {
    \"chartType\": \"line\",
    \"config\": {
      \"title\": \"Loan ..."
[Log] Processing analysis block 0: type=chart, title=Loan Portfolio Composition Trends
[Log] Found direct chart data in block 0: line
[Log] Chart data structure: – {hasConfig: true, hasChartConfig: true, chartConfigKeys: ["ci", "cre", "residential", …], …}
{hasConfig: true, hasChartConfig: true, chartConfigKeys: ["ci", "cre", "residential", "consumer"], dataLength: 5, sampleData: Object}Object
[Log] Processing analysis block 1: type=table, title=Loan Portfolio Growth Analysis
[Log] Found direct table data in block 1: detailed
[Log] Processing analysis block 2: type=metric, title=Non-Performing Assets Ratio
[Log] Found metric block 2: Non-Performing Assets Ratio
[Log] Processing analysis block 3: type=metric, title=Quarter-over-Quarter Loan Growth Rate
[Log] Found metric block 3: Quarter-over-Quarter Loan Growth Rate
[Log] Returning cumulative visualization data from analysis_blocks: 1 charts, 1 tables, 2 metrics
[Log] Checking 3 messages for cumulative visualization data...
[Log] Examining assistant message 2: – "ID: bb3ce72a-5f9c-44f6-810b-f3a6776da24e" – "Has 4 analysis blocks"
[Log] Found 4 analysis blocks in message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
[Log] Analysis blocks structure: – "{↵  \"id\": \"8eff717a-c23b-4bc8-9f89-717f39da9df2\",↵  \"block_type\": \"chart\",↵  \"title\": \"Loan Portfolio Composition Trends\",↵  \"content\": {↵…"
"{
  \"id\": \"8eff717a-c23b-4bc8-9f89-717f39da9df2\",
  \"block_type\": \"chart\",
  \"title\": \"Loan Portfolio Composition Trends\",
  \"content\": {
    \"chartType\": \"line\",
    \"config\": {
      \"title\": \"Loan ..."
[Log] Processing analysis block 0: type=chart, title=Loan Portfolio Composition Trends
[Log] Found direct chart data in block 0: line
[Log] Chart data structure: – {hasConfig: true, hasChartConfig: true, chartConfigKeys: ["ci", "cre", "residential", …], …}
{hasConfig: true, hasChartConfig: true, chartConfigKeys: ["ci", "cre", "residential", "consumer"], dataLength: 5, sampleData: Object}Object
[Log] Processing analysis block 1: type=table, title=Loan Portfolio Growth Analysis
[Log] Found direct table data in block 1: detailed
[Log] Processing analysis block 2: type=metric, title=Non-Performing Assets Ratio
[Log] Found metric block 2: Non-Performing Assets Ratio
[Log] Processing analysis block 3: type=metric, title=Quarter-over-Quarter Loan Growth Rate
[Log] Found metric block 3: Quarter-over-Quarter Loan Growth Rate
[Log] Returning cumulative visualization data from analysis_blocks: 1 charts, 1 tables, 2 metrics
[Log] ChartRenderer - Data received: – {chartType: "line", hasData: true, dataLength: 5, …}
{chartType: "line", hasData: true, dataLength: 5, hasConfig: true, hasChartConfig: true, …}Object
[Log] ChartRenderer - Data received: – {chartType: "line", hasData: true, dataLength: 5, …}
{chartType: "line", hasData: true, dataLength: 5, hasConfig: true, hasChartConfig: true, …}Object
[Log] LineChart - Debug Info: – {chartType: "line", hasConfig: true, hasChartConfig: true, …}
{chartType: "line", hasConfig: true, hasChartConfig: true, chartConfigKeys: ["ci", "cre", "residential", "consumer"], dataLength: 5, …}Object
[Log] LineChart - Final render data: – {processedDataLength: 5, processedDataFirst: Object, metricKeys: ["ci", "cre", "residential", …], …}
{processedDataLength: 5, processedDataFirst: Object, metricKeys: ["ci", "cre", "residential", "consumer"], categoryKey: "period", linesCount: 4}Object
[Log] LineChart - Debug Info: – {chartType: "line", hasConfig: true, hasChartConfig: true, …}
{chartType: "line", hasConfig: true, hasChartConfig: true, chartConfigKeys: ["ci", "cre", "residential", "consumer"], dataLength: 5, …}Object
[Log] LineChart - Final render data: – {processedDataLength: 5, processedDataFirst: Object, metricKeys: ["ci", "cre", "residential", …], …}
{processedDataLength: 5, processedDataFirst: Object, metricKeys: ["ci", "cre", "residential", "consumer"], categoryKey: "period", linesCount: 4}Object
[Log] PDFViewer unmounting, cleaning up resources
[Log] Checking 3 messages for cumulative visualization data...
[Log] Examining assistant message 2: – "ID: bb3ce72a-5f9c-44f6-810b-f3a6776da24e" – "Has 4 analysis blocks"
[Log] Found 4 analysis blocks in message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
[Log] Analysis blocks structure: – "{↵  \"id\": \"8eff717a-c23b-4bc8-9f89-717f39da9df2\",↵  \"block_type\": \"chart\",↵  \"title\": \"Loan Portfolio Composition Trends\",↵  \"content\": {↵…"
"{
  \"id\": \"8eff717a-c23b-4bc8-9f89-717f39da9df2\",
  \"block_type\": \"chart\",
  \"title\": \"Loan Portfolio Composition Trends\",
  \"content\": {
    \"chartType\": \"line\",
    \"config\": {
      \"title\": \"Loan ..."
[Log] Processing analysis block 0: type=chart, title=Loan Portfolio Composition Trends
[Log] Found direct chart data in block 0: line
[Log] Chart data structure: – {hasConfig: true, hasChartConfig: true, chartConfigKeys: ["ci", "cre", "residential", …], …}
{hasConfig: true, hasChartConfig: true, chartConfigKeys: ["ci", "cre", "residential", "consumer"], dataLength: 5, sampleData: Object}Object
[Log] Processing analysis block 1: type=table, title=Loan Portfolio Growth Analysis
[Log] Found direct table data in block 1: detailed
[Log] Processing analysis block 2: type=metric, title=Non-Performing Assets Ratio
[Log] Found metric block 2: Non-Performing Assets Ratio
[Log] Processing analysis block 3: type=metric, title=Quarter-over-Quarter Loan Growth Rate
[Log] Found metric block 3: Quarter-over-Quarter Loan Growth Rate
[Log] Returning cumulative visualization data from analysis_blocks: 1 charts, 1 tables, 2 metrics
[Log] Checking 3 messages for cumulative visualization data...
[Log] Examining assistant message 2: – "ID: bb3ce72a-5f9c-44f6-810b-f3a6776da24e" – "Has 4 analysis blocks"
[Log] Found 4 analysis blocks in message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
[Log] Analysis blocks structure: – "{↵  \"id\": \"8eff717a-c23b-4bc8-9f89-717f39da9df2\",↵  \"block_type\": \"chart\",↵  \"title\": \"Loan Portfolio Composition Trends\",↵  \"content\": {↵…"
"{
  \"id\": \"8eff717a-c23b-4bc8-9f89-717f39da9df2\",
  \"block_type\": \"chart\",
  \"title\": \"Loan Portfolio Composition Trends\",
  \"content\": {
    \"chartType\": \"line\",
    \"config\": {
      \"title\": \"Loan ..."
[Log] Processing analysis block 0: type=chart, title=Loan Portfolio Composition Trends
[Log] Found direct chart data in block 0: line
[Log] Chart data structure: – {hasConfig: true, hasChartConfig: true, chartConfigKeys: ["ci", "cre", "residential", …], …}
{hasConfig: true, hasChartConfig: true, chartConfigKeys: ["ci", "cre", "residential", "consumer"], dataLength: 5, sampleData: Object}Object
[Log] Processing analysis block 1: type=table, title=Loan Portfolio Growth Analysis
[Log] Found direct table data in block 1: detailed
[Log] Processing analysis block 2: type=metric, title=Non-Performing Assets Ratio
[Log] Found metric block 2: Non-Performing Assets Ratio
[Log] Processing analysis block 3: type=metric, title=Quarter-over-Quarter Loan Growth Rate
[Log] Found metric block 3: Quarter-over-Quarter Loan Growth Rate
[Log] Returning cumulative visualization data from analysis_blocks: 1 charts, 1 tables, 2 metrics
[Log] ChartRenderer - Data received: – {chartType: "line", hasData: true, dataLength: 5, …}
{chartType: "line", hasData: true, dataLength: 5, hasConfig: true, hasChartConfig: true, …}Object
[Log] ChartRenderer - Data received: – {chartType: "line", hasData: true, dataLength: 5, …}
{chartType: "line", hasData: true, dataLength: 5, hasConfig: true, hasChartConfig: true, …}Object
[Log] LineChart - Debug Info: – {chartType: "line", hasConfig: true, hasChartConfig: true, …}
{chartType: "line", hasConfig: true, hasChartConfig: true, chartConfigKeys: ["ci", "cre", "residential", "consumer"], dataLength: 5, …}Object
[Log] LineChart - Final render data: – {processedDataLength: 5, processedDataFirst: Object, metricKeys: ["ci", "cre", "residential", …], …}
{processedDataLength: 5, processedDataFirst: Object, metricKeys: ["ci", "cre", "residential", "consumer"], categoryKey: "period", linesCount: 4}Object
[Log] LineChart - Debug Info: – {chartType: "line", hasConfig: true, hasChartConfig: true, …}
{chartType: "line", hasConfig: true, hasChartConfig: true, chartConfigKeys: ["ci", "cre", "residential", "consumer"], dataLength: 5, …}Object
[Log] LineChart - Final render data: – {processedDataLength: 5, processedDataFirst: Object, metricKeys: ["ci", "cre", "residential", …], …}
{processedDataLength: 5, processedDataFirst: Object, metricKeys: ["ci", "cre", "residential", "consumer"], categoryKey: "period", linesCount: 4}Object
[Log] PDFViewer unmounting, cleaning up resources
[Log] Sending GET request to http://localhost:8000/api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb/citations
[Log] Deprecated API usage: The `enhanceTextSelection` functionality will be removed in the future. (x3)
</JavaScript_Console_Output>


<Backend_Logs>
(venv) alexcardell@Alexs-MBP backend % cd /Users/alexcardell/AlexCoding_Local/cfin/backend && PYTHONPATH=$PYTHONPATH:/Users/alexcardell/AlexCoding_Local/cfin/backend python -m uvicorn app.main:app --reload --port 8000
INFO:     Will watch for changes in these directories: ['/Users/alexcardell/AlexCoding_Local/cfin/backend']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [74728] using StatReload
INFO:root:Loaded environment variables from /Users/alexcardell/AlexCoding_Local/cfin/.env
INFO:root:ANTHROPIC_API_KEY loaded: sk-ant-a...TQAA
INFO:app.main:CORS: Allowing origins: ['http://localhost:3000', 'http://localhost:3001', 'http://localhost:3002', 'http://localhost:3003', 'http://127.0.0.1:3000', 'http://127.0.0.1:3001', 'http://127.0.0.1:3002', 'http://127.0.0.1:3003', 'http://127.0.0.1:49937', 'http://127\\.0\\.0\\.1:\\d+', 'http://127.0.0.1:64142']
INFO:     Started server process [74730]
INFO:     Waiting for application startup.
INFO:app.main:Initializing database...
INFO:utils.init_db:Creating database tables...
INFO:utils.init_db:Database tables created successfully.
INFO:utils.init_db:Default user already exists.
INFO:utils.init_db:Database initialization completed successfully.
INFO:app.main:Database initialization completed successfully
INFO:     Application startup complete.
INFO:     127.0.0.1:62440 - "OPTIONS /api/conversation HTTP/1.1" 200 OK
INFO:     127.0.0.1:62441 - "OPTIONS /api/conversation HTTP/1.1" 200 OK
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.conversation:Created conversation: c7aaea0c-1c94-405c-a5e4-bd0662072c9e for user: default-user
INFO:app.routes.conversation:Created conversation: ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d for user: default-user
INFO:     127.0.0.1:62440 - "POST /api/conversation HTTP/1.1" 201 Created
INFO:     127.0.0.1:62441 - "POST /api/conversation HTTP/1.1" 201 Created
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     127.0.0.1:62440 - "GET /api/conversation/ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d HTTP/1.1" 200 OK
INFO:app.routes.websocket:WebSocket endpoint called for conversation: ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d, user: default-user
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     ('127.0.0.1', 62441) - "WebSocket /ws/conversation/ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d" [accepted]
INFO:app.routes.websocket:WebSocket connected: default-user_ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d_1750392185171
INFO:app.routes.websocket:WebSocket connection established for conversation: ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d
INFO:     connection open
INFO:app.routes.websocket:Found conversation: ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d
INFO:     127.0.0.1:62444 - "OPTIONS /api/documents/upload HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:utils.storage:File b5bb1f8a-61a1-491c-b6a3-c916803c48fb.pdf saved to ./uploads/b5bb1f8a-61a1-491c-b6a3-c916803c48fb.pdf
INFO:     127.0.0.1:62444 - "POST /api/documents/upload HTTP/1.1" 200 OK
INFO:pdf_processing.document_service:Starting optimized processing of document b5bb1f8a-61a1-491c-b6a3-c916803c48fb (Bank_5Q_Trend_Report.pdf) with Claude Files API
INFO:pdf_processing.document_service:No cached file_id for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb, performing full processing
INFO:pdf_processing.api_service:Processing PDF: Bank_5Q_Trend_Report.pdf with Claude API using native PDF support.
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/files "HTTP/1.1 200 OK"
INFO:utils.file_cache:Cached file_id=file_011CQJosMds18FUQAmru7JZP for content hash=9c15100a12f1a9ad... (expires: 2025-09-17 23:03:13, cache size: 1)
INFO:audit.pdf_access:PDF_ACCESS: {'timestamp': 'AUTO', 'operation': 'upload', 'file_id': 'file_011CQJosMds18FUQAmru7JZP', 'user_context': 'system', 'file_size_bytes': 29802, 'privacy_note': 'PDF content not logged for compliance'}
INFO:pdf_processing.claude_file_client:Uploaded Bank_5Q_Trend_Report.pdf (0.0 MB) → file_011CQJosMds18FUQAmru7JZP
INFO:pdf_processing.api_service:Generated Claude file_id file_011CQJosMds18FUQAmru7JZP for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Analyzing document type for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Analyzing document type for Bank_5Q_Trend_Report.pdf using file_id=file_011CQJosMds18FUQAmru7JZP
INFO:pdf_processing.model_router:Using Haiku for light tools set() with 1000 tokens (haiku_calls=1, sonnet_calls=0)
INFO:pdf_processing.api_service:Model router selected claude-3-5-haiku-20241022 for document type analysis
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (non-streaming): 117 (Custom estimate: 117)
INFO:pdf_processing.api_service:Throttling based on token count: 117 (SDK count: 117, Custom estimate: 117)
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
WARNING:pdf_processing.api_service:Invalid document type 'integrated_financial_statement', using OTHER
INFO:pdf_processing.api_service:Document Bank_5Q_Trend_Report.pdf classified as other with periods: ['2024Q1', '2024Q2', '2024Q3', '2024Q4', '2025Q1']
INFO:pdf_processing.api_service:Document Bank_5Q_Trend_Report.pdf classified as: other with periods: ['2024Q1', '2024Q2', '2024Q3', '2024Q4', '2025Q1']
INFO:pdf_processing.api_service:Extracting structured financial data and citations for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Extracting structured financial data with citations from: Bank_5Q_Trend_Report.pdf using file_id file_011CQJosMds18FUQAmru7JZP
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (non-streaming): 177 (Custom estimate: 101)
INFO:pdf_processing.api_service:Throttling based on token count: 177 (SDK count: 177, Custom estimate: 101)
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Successfully parsed financial JSON from Claude's response.
INFO:pdf_processing.api_service:Captured Claude's preamble text, length: 120
INFO:pdf_processing.api_service:Extracted 0 citations for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Structured financial data keys for Bank_5Q_Trend_Report.pdf: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json']
INFO:pdf_processing.api_service:Added claude_file_id file_011CQJosMds18FUQAmru7JZP to extracted_data for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.document_service:Processed document using Files API: PDF Bank_5Q_Trend_Report.pdf processed using Claude's native PDF support via Files API
INFO:pdf_processing.document_service:Extracted claude_file_id file_011CQJosMds18FUQAmru7JZP from processed document data
INFO:pdf_processing.document_service:Stored claude_file_id file_011CQJosMds18FUQAmru7JZP in database for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb
INFO:pdf_processing.document_service:Updating document b5bb1f8a-61a1-491c-b6a3-c916803c48fb content with Claude optimizations using Files API
INFO:pdf_processing.document_service:Document b5bb1f8a-61a1-491c-b6a3-c916803c48fb processed with Claude optimizations. File ID: file_011CQJosMds18FUQAmru7JZP
INFO:pdf_processing.document_service:Storing 0 citations for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb
INFO:pdf_processing.document_service:Successfully completed optimized processing for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Document b5bb1f8a-61a1-491c-b6a3-c916803c48fb accepted for financial analysis
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb/check-financial-data HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Document b5bb1f8a-61a1-491c-b6a3-c916803c48fb accepted for financial analysis
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb/check-financial-data HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "OPTIONS /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb/verify-financial-data HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Document b5bb1f8a-61a1-491c-b6a3-c916803c48fb has extracted_data with keys: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json', 'claude_file_id']
INFO:     127.0.0.1:62444 - "POST /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb/verify-financial-data HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:     127.0.0.1:62444 - "OPTIONS /api/conversation/ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d/document/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     127.0.0.1:62444 - "POST /api/conversation/ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d/document/b5bb1f8a-61a1-491c-b6a3-c916803c48fb HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Retrieving file for document: b5bb1f8a-61a1-491c-b6a3-c916803c48fb
INFO:app.routes.document:Returning binary PDF data for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb, size: 29802 bytes
INFO:     127.0.0.1:62444 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb/file HTTP/1.1" 200 OK
INFO:     127.0.0.1:62449 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb/citations HTTP/1.1" 200 OK
INFO:repositories.document_repository:Retrieving document content using file path: b5bb1f8a-61a1-491c-b6a3-c916803c48fb.pdf
INFO:repositories.document_repository:Requesting file from storage service for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb
INFO:repositories.document_repository:Retrieved PDF content for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb: 29802 bytes
INFO:repositories.document_repository:Document b5bb1f8a-61a1-491c-b6a3-c916803c48fb has claude_file_id: file_011CQJosMds18FUQAmru7JZP (native PDF support available)
INFO:repositories.document_repository:PDF document b5bb1f8a-61a1-491c-b6a3-c916803c48fb uses claude_file_id for native support - raw_text not required
INFO:repositories.document_repository:Extracted data available for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json', 'claude_file_id']
INFO:repositories.document_repository:Successfully retrieved content for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb
INFO:services.conversation_service:Retrieved content for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb: content size=29802, raw_text size=0
INFO:services.conversation_service:Document b5bb1f8a-61a1-491c-b6a3-c916803c48fb available content types: content, extracted_data
INFO:services.conversation_service:Added document b5bb1f8a-61a1-491c-b6a3-c916803c48fb to context for conversation ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d
INFO:repositories.document_repository:Retrieving document content using file path: b5bb1f8a-61a1-491c-b6a3-c916803c48fb.pdf
INFO:repositories.document_repository:Requesting file from storage service for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb
INFO:repositories.document_repository:Retrieved PDF content for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb: 29802 bytes
INFO:repositories.document_repository:Document b5bb1f8a-61a1-491c-b6a3-c916803c48fb has claude_file_id: file_011CQJosMds18FUQAmru7JZP (native PDF support available)
INFO:repositories.document_repository:PDF document b5bb1f8a-61a1-491c-b6a3-c916803c48fb uses claude_file_id for native support - raw_text not required
INFO:repositories.document_repository:Extracted data available for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json', 'claude_file_id']
INFO:repositories.document_repository:Successfully retrieved content for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb
INFO:services.conversation_service:Added document b5bb1f8a-61a1-491c-b6a3-c916803c48fb with Files API file_id: file_011CQJosMds18FUQAmru7JZP
INFO:services.conversation_service:Using unified streaming approach with tools available for conversation ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d
INFO:services.conversation_service:Using Files API claude_file_id file_011CQJosMds18FUQAmru7JZP for unified streaming analysis
INFO:pdf_processing.api_service:Starting streaming analyze_with_visualization_tools for query: 'How have loans trended?...'
INFO:pdf_processing.api_service:Streaming visualization analysis turn 1/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_graph_data', 'generate_financial_metric', 'generate_comparative_period', 'generate_table_data'} with 45 tokens (haiku_calls=1, sonnet_calls=1)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 4322 (Custom estimate: 39)
INFO:pdf_processing.api_service:Throttling based on token count: 4322 (SDK count: 4322, Custom estimate: 39)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
ERROR:sqlalchemy.pool.impl.NullPool:The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-35, started daemon 6176616448)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
/Users/alexcardell/AlexCoding_Local/venv/lib/python3.9/site-packages/pydantic/_internal/_core_utils.py:301: SAWarning: The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-35, started daemon 6176616448)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
  for v in schema['choices']:
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 3 characters (initial: True)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 46 characters (initial: True)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 79 characters (initial: True)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 101 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 137 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 177 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 192 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 199 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 218 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 242 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 299 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 306 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 315 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 323 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 339 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 357 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 382 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 407 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 435 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 455 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 491 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 525 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 551 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 566 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 599 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 625 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 634 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 652 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 670 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 683 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 691 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 706 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 726 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 750 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 760 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 770 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 793 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 831 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 848 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 863 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 869 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 888 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 899 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 929 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 938 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 940 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 971 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 984 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 1021 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 1031 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 1040 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 1047 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 1073 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 1094 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 1102 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 1120 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 1132 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 1173 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 1187 characters (initial: False)
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_graph_data: type=<class 'dict'>
INFO:pdf_processing.api_service:Turn 1: Initial streaming text preserved (1187 chars)
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_graph_data (ID: toolu_01Smka1QzbY7BKnXMEzT91hJ)
INFO:pdf_processing.api_service:Processing streaming tool generate_graph_data (ID: toolu_01Smka1QzbY7BKnXMEzT91hJ)
INFO:pdf_processing.api_service:Tool generate_graph_data (ID: toolu_01Smka1QzbY7BKnXMEzT91hJ) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_graph_data (ID: toolu_01Smka1QzbY7BKnXMEzT91hJ) - dict input keys: ['chartType', 'config', 'data', 'chartConfig']
INFO:utils.tool_processing:Processing generate_graph_data (ID: toolu_01Smka1QzbY7BKnXMEzT91hJ) - input type: <class 'dict'>
INFO:utils.tool_processing:Starting process_chart_input with input type: <class 'dict'>
INFO:utils.tool_processing:Chart input keys: ['chartType', 'config', 'data', 'chartConfig']
INFO:utils.tool_processing:Chart config type: <class 'str'>
INFO:utils.tool_processing:Chart data type: <class 'list'>, length: 5
INFO:utils.tool_processing:Chart chartConfig type: <class 'dict'>
WARNING:utils.tool_processing:Chart config is a JSON string, parsing it
INFO:utils.tool_processing:Successfully parsed config JSON string
INFO:utils.tool_processing:Chart config keys: ['title', 'xAxisKey', 'xAxisLabel', 'yAxisLabel', 'description', 'showLegend']
INFO:utils.tool_processing:Successfully got original_data: type=<class 'list'>
INFO:utils.tool_processing:Chart type: line
INFO:utils.tool_processing:Chart config settings type: <class 'dict'>
INFO:utils.tool_processing:x_axis_key: period
INFO:utils.tool_processing:Transforming chart data to {x, y} format required by ChartDataItem model
INFO:utils.tool_processing:Line chart with multiple series (['ci', 'cre', 'residential', 'consumer']) - keeping flat format
INFO:utils.tool_processing:Successfully processed chart: Loan Portfolio Composition Trends
INFO:pdf_processing.api_service:Streaming visualization analysis turn 2/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_graph_data', 'generate_financial_metric', 'generate_comparative_period', 'generate_table_data'} with 1005 tokens (haiku_calls=1, sonnet_calls=2)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 5593 (Custom estimate: 336)
INFO:pdf_processing.api_service:Throttling based on token count: 5593 (SDK count: 5593, Custom estimate: 336)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_table_data: type=<class 'dict'>
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_table_data (ID: toolu_01NoHsLLxoWAv2CH7JeXjcbu)
INFO:pdf_processing.api_service:Processing streaming tool generate_table_data (ID: toolu_01NoHsLLxoWAv2CH7JeXjcbu)
INFO:pdf_processing.api_service:Tool generate_table_data (ID: toolu_01NoHsLLxoWAv2CH7JeXjcbu) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_table_data (ID: toolu_01NoHsLLxoWAv2CH7JeXjcbu) - dict input keys: ['tableType', 'config', 'data']
INFO:utils.tool_processing:Processing generate_table_data (ID: toolu_01NoHsLLxoWAv2CH7JeXjcbu) - input type: <class 'dict'>
INFO:utils.tool_processing:Starting process_table_input with input type: <class 'dict'>
INFO:utils.tool_processing:Table input keys: ['tableType', 'config', 'data']
INFO:utils.tool_processing:Table config type: <class 'str'>
INFO:utils.tool_processing:Table data type: <class 'list'>, length: 5
WARNING:utils.tool_processing:Table config is a JSON string, parsing it
INFO:utils.tool_processing:Successfully parsed table config JSON string
INFO:utils.tool_processing:Successfully processed table: Loan Portfolio Growth Analysis
INFO:pdf_processing.api_service:Streaming visualization analysis turn 3/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_graph_data', 'generate_financial_metric', 'generate_comparative_period', 'generate_table_data'} with 1687 tokens (haiku_calls=1, sonnet_calls=3)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 6662 (Custom estimate: 336)
INFO:pdf_processing.api_service:Throttling based on token count: 6662 (SDK count: 6662, Custom estimate: 336)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_financial_metric: type=<class 'dict'>
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_financial_metric (ID: toolu_01GwbGHHNEarujyn8ViAXBZt)
INFO:pdf_processing.api_service:Processing streaming tool generate_financial_metric (ID: toolu_01GwbGHHNEarujyn8ViAXBZt)
INFO:pdf_processing.api_service:Tool generate_financial_metric (ID: toolu_01GwbGHHNEarujyn8ViAXBZt) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_financial_metric (ID: toolu_01GwbGHHNEarujyn8ViAXBZt) - dict input keys: ['category', 'name', 'period', 'value', 'unit', 'isEstimated']
INFO:utils.tool_processing:Processing generate_financial_metric (ID: toolu_01GwbGHHNEarujyn8ViAXBZt) - input type: <class 'dict'>
INFO:utils.tool_processing:Successfully processed financial metric: Non-Performing Assets Ratio
INFO:pdf_processing.api_service:Streaming visualization analysis turn 4/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_graph_data', 'generate_financial_metric', 'generate_comparative_period', 'generate_table_data'} with 1807 tokens (haiku_calls=1, sonnet_calls=4)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 6877 (Custom estimate: 336)
INFO:pdf_processing.api_service:Throttling based on token count: 6877 (SDK count: 6877, Custom estimate: 336)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_financial_metric: type=<class 'dict'>
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_financial_metric (ID: toolu_011JexdSkvphhfpK12sqnPPX)
INFO:pdf_processing.api_service:Processing streaming tool generate_financial_metric (ID: toolu_011JexdSkvphhfpK12sqnPPX)
INFO:pdf_processing.api_service:Tool generate_financial_metric (ID: toolu_011JexdSkvphhfpK12sqnPPX) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_financial_metric (ID: toolu_011JexdSkvphhfpK12sqnPPX) - dict input keys: ['category', 'name', 'period', 'value', 'unit', 'isEstimated']
INFO:utils.tool_processing:Processing generate_financial_metric (ID: toolu_011JexdSkvphhfpK12sqnPPX) - input type: <class 'dict'>
INFO:utils.tool_processing:Successfully processed financial metric: Quarter-over-Quarter Loan Growth Rate
INFO:pdf_processing.api_service:Streaming visualization analysis turn 5/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_graph_data', 'generate_financial_metric', 'generate_comparative_period', 'generate_table_data'} with 1929 tokens (haiku_calls=1, sonnet_calls=5)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 7098 (Custom estimate: 336)
INFO:pdf_processing.api_service:Throttling based on token count: 7098 (SDK count: 7098, Custom estimate: 336)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 3 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 20 characters (initial: True)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 44 characters (initial: True)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 87 characters (initial: True)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 102 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 132 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 154 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 186 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 210 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 236 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 243 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 251 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 266 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 282 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 303 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 334 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 343 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 356 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 379 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 394 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 403 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 428 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 463 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 491 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 530 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 571 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 605 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 635 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 665 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 695 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 723 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 764 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 791 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 821 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 853 characters (initial: False)
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Updated message content in database with 854 characters (initial: False)
INFO:pdf_processing.api_service:Turn 5: Adding new content (854 chars)
INFO:pdf_processing.api_service:Streaming visualization analysis completed: no more tools
INFO:pdf_processing.api_service:Streaming visualization analysis completed: 1 charts, 1 tables, 2 metrics. Analysis text length: 2043
INFO:services.conversation_service:Current assistant message content length: 854
INFO:services.conversation_service:Analysis text length: 2043
INFO:services.conversation_service:Appending new analysis insights to existing content
INFO:repositories.conversation_repository:Updated and re-fetched message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Sent message_update event for bb3ce72a-5f9c-44f6-810b-f3a6776da24e after streaming complete
INFO:services.conversation_service:DEBUG: result.get('metrics'): [{'category': 'Credit Quality', 'name': 'Non-Performing Assets Ratio', 'period': '2025Q1', 'value': 0.87, 'unit': '%', 'isEstimated': False}, {'category': 'Loan Growth', 'name': 'Quarter-over-Quarter Loan Growth Rate', 'period': '2025Q1', 'value': 2.27, 'unit': '%', 'isEstimated': False}]
INFO:services.conversation_service:DEBUG: accumulated_metrics: [{'category': 'Credit Quality', 'name': 'Non-Performing Assets Ratio', 'period': '2025Q1', 'value': 0.87, 'unit': '%', 'isEstimated': False}, {'category': 'Loan Growth', 'name': 'Quarter-over-Quarter Loan Growth Rate', 'period': '2025Q1', 'value': 2.27, 'unit': '%', 'isEstimated': False}]
INFO:services.conversation_service:Processing visualizations for conversation ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d: charts=1, tables=1, metrics=2
INFO:services.conversation_service:Processing chart: Loan Portfolio Composition Trends
INFO:services.conversation_service:Processing table: Loan Portfolio Growth Analysis
INFO:services.conversation_service:Processing metric: Non-Performing Assets Ratio
INFO:services.conversation_service:Processing metric: Quarter-over-Quarter Loan Growth Rate
INFO:services.conversation_service:Storing 4 analysis blocks for streaming message bb3ce72a-5f9c-44f6-810b-f3a6776da24e
INFO:services.conversation_service:Refreshed streaming assistant_message bb3ce72a-5f9c-44f6-810b-f3a6776da24e to load analysis_blocks
INFO:services.conversation_service:Sending message_complete event for conversation ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d after analysis blocks stored
INFO:services.conversation_service:message_complete event sent for conversation ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d after analysis blocks
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     127.0.0.1:62495 - "GET /api/conversation/message/bb3ce72a-5f9c-44f6-810b-f3a6776da24e HTTP/1.1" 200 OK
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:pdf_processing.api_service:Sending request to Claude API with 1 messages, streaming: False
INFO:pdf_processing.api_service:Sending request to Claude API with 1 messages, streaming: False
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (generate_response non-streaming): 916
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (generate_response non-streaming): 916
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (non-streaming): 916 (Custom estimate: 957)
INFO:pdf_processing.api_service:Throttling based on token count: 916 (SDK count: 916, Custom estimate: 957)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (non-streaming): 916 (Custom estimate: 957)
INFO:pdf_processing.api_service:Throttling based on token count: 916 (SDK count: 916, Custom estimate: 957)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:     127.0.0.1:62495 - "POST /api/conversation/ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d/generate-followups?limit=3 HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:     127.0.0.1:62496 - "POST /api/conversation/ebb0fd5d-a5c5-4dbc-a4b3-4f86a765b68d/generate-followups?limit=3 HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Retrieving file for document: b5bb1f8a-61a1-491c-b6a3-c916803c48fb
INFO:app.routes.document:Returning binary PDF data for document b5bb1f8a-61a1-491c-b6a3-c916803c48fb, size: 29802 bytes
INFO:     127.0.0.1:62513 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb/file HTTP/1.1" 200 OK
INFO:     127.0.0.1:62514 - "GET /api/documents/b5bb1f8a-61a1-491c-b6a3-c916803c48fb/citations HTTP/1.1" 200 OK
</Backend_Logs>