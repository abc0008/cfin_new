
<JavaScript_Console_Output>
[Info] Successfully preconnected to https://fonts.gstatic.com/
[Info] Successfully preconnected to https://fonts.googleapis.com/
[Error] Failed to load resource: the server responded with a status of 400 () (font, line 0)
[Error] Failed to load resource: the server responded with a status of 400 () (font, line 0)
[Log] 🌐 API Service Available
[Log] Use __apiService to access the API directly in the console
[Log] Sending POST request to http://localhost:8000/api/conversation
[Log] Sending POST request to http://localhost:8000/api/conversation
[Log] Created conversation session: 829786ef-0823-4104-9b6d-81ff1e14ba26
[Log] Created conversation session: d8bed35a-193e-44db-a2a7-7582593c05b7
[Log] Created conversation session: – "d8bed35a-193e-44db-a2a7-7582593c05b7"
[Log] Validating conversation exists: – "d8bed35a-193e-44db-a2a7-7582593c05b7"
[Log] Sending GET request to http://localhost:8000/api/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7
[Log] Starting WebSocket connection to: – "ws://localhost:8000/ws/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7"
[Log] Current isConnected state before connection: – false
[Log] WebSocket onopen event fired for conversation: – "d8bed35a-193e-44db-a2a7-7582593c05b7"
[Log] WebSocket connected and isConnected set to true for conversation: – "d8bed35a-193e-44db-a2a7-7582593c05b7"
[Log] File selected: – "Bank_5Q_Trend_Report.pdf"
[Log] Validating file: – "Bank_5Q_Trend_Report.pdf"
[Log] File validation successful
[Log] Uploading document...
[Log] Upload progress: 0.00%, Stage: Starting upload
[Log] Uploading file to http://localhost:8000/api/documents/upload
[Log] Upload progress: 40.00%, Stage: Uploading file
[Log] Polling for document processing completion...
[Log] Upload progress: 40.00%, Stage: Processing document
[Log] Upload progress: 40.00%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 1: processing
[Log] Upload progress: 40.27%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 2: processing
[Log] Upload progress: 40.53%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 3: processing
[Log] Upload progress: 40.80%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 4: processing
[Log] Upload progress: 41.07%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 5: processing
[Log] Upload progress: 41.33%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 6: processing
[Log] Upload progress: 41.60%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 7: processing
[Log] Upload progress: 41.87%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 8: processing
[Log] Upload progress: 42.13%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 9: processing
[Log] Upload progress: 42.40%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 10: processing
[Log] Upload progress: 42.67%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 11: processing
[Log] Upload progress: 42.93%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 12: processing
[Log] Upload progress: 43.20%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 13: processing
[Log] Upload progress: 43.47%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 14: processing
[Log] Upload progress: 43.73%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 15: processing
[Log] Upload progress: 44.00%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 16: processing
[Log] Upload progress: 44.27%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 17: processing
[Log] Upload progress: 44.53%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document status after attempt 18: completed
[Log] Verifying financial data...
[Log] Upload progress: 80.00%, Stage: Verifying financial data
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61/check-financial-data
[Log] Document needs financial data verification: – "Document accepted for financial analysis"
[Log] Upload progress: 85.00%, Stage: Enhancing financial data
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61/check-financial-data
[Log] Sending POST request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61/verify-financial-data
[Log] Financial data verification result: – {success: true, message: "Document content verified for analysis"}
[Log] Upload progress: 90.00%, Stage: Retrieving enhanced data
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Upload progress: 100.00%, Stage: Document ready
[Log] Document verification completed: – {metadata: Object, contentType: "integrated_financial_report", extractionTimestamp: "2025-06-23T05:53:50.388Z", …}
{metadata: Object, contentType: "integrated_financial_report", extractionTimestamp: "2025-06-23T05:53:50.388Z", periods: ["2024Q1", "2024Q2", "2024Q3", "2024Q4", "2025Q1"], extractedData: Object, …}Object
[Log] Associating document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 with conversation d8bed35a-193e-44db-a2a7-7582593c05b7
[Log] Sending POST request to http://localhost:8000/api/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7/document/1340da4f-0a74-4e7f-a24b-489a6d92ee61
[Log] Document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 added to conversation d8bed35a-193e-44db-a2a7-7582593c05b7
[Log] Document successfully associated with conversation
[Log] [Fast Refresh] rebuilding
[Log] PDFViewer unmounting, cleaning up resources
[Log] Sending GET request to http://localhost:8000/api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61/citations
[Log] [Fast Refresh] done in 208ms
[Log] [Fast Refresh] done in 272ms
[Log] Deprecated API usage: The `enhanceTextSelection` functionality will be removed in the future.
[Error] Source Map loading errors (x2)
[Error] Failed to load resource: the server responded with a status of 404 (Not Found) (types.js.map, line 0)
[Error] Failed to load resource: the server responded with a status of 404 (Not Found) (types.js.map, line 0)
[Log] Deprecated API usage: The `enhanceTextSelection` functionality will be removed in the future. (x2)
[Log] Submit conditions: useStreaming=true, conversationId=d8bed35a-193e-44db-a2a7-7582593c05b7, isConnected=true
[Log] Using WebSocket streaming for message submission
[Log] 🔍 State check on message_start: – {messagePhase: null, activeMessageId: null, streamingMessageId: null, …}
{messagePhase: null, activeMessageId: null, streamingMessageId: null, phaseTransitions: 0}Object
[Log] 🚀 Starting new message: 611dce0f-f3aa-457c-a781-2a0336319e42
[Log] 📝 Building initial streaming: 3 chars
[Log] 📝 Initial streaming update: 3 chars
[Log] 📝 Building initial streaming: 46 chars
[Log] 📝 Initial streaming update: 46 chars
[Log] 📝 Building initial streaming: 78 chars
[Log] 📝 Initial streaming update: 78 chars
[Log] 📝 Building initial streaming: 111 chars
[Log] 📝 Initial streaming update: 111 chars
[Log] 📝 Building initial streaming: 168 chars
[Log] 📝 Initial streaming update: 168 chars
[Log] 📝 Building initial streaming: 206 chars
[Log] 📝 Initial streaming update: 206 chars
[Log] 📝 Building initial streaming: 241 chars
[Log] 📝 Initial streaming update: 241 chars
[Log] 📝 Building initial streaming: 276 chars
[Log] 📝 Initial streaming update: 276 chars
[Log] 📝 Building initial streaming: 303 chars
[Log] 📝 Initial streaming update: 303 chars
[Log] 📝 Building initial streaming: 332 chars
[Log] 📝 Initial streaming update: 332 chars
[Log] 📝 Building initial streaming: 359 chars
[Log] 📝 Initial streaming update: 359 chars
[Log] 📝 Building initial streaming: 372 chars
[Log] 📝 Initial streaming update: 372 chars
[Log] 📝 Building initial streaming: 381 chars
[Log] 📝 Initial streaming update: 381 chars
[Log] 📝 Building initial streaming: 394 chars
[Log] 📝 Initial streaming update: 394 chars
[Log] 📝 Building initial streaming: 417 chars
[Log] 📝 Initial streaming update: 417 chars
[Log] 📝 Building initial streaming: 453 chars
[Log] 📝 Initial streaming update: 453 chars
[Log] 📝 Building initial streaming: 507 chars
[Log] 📝 Initial streaming update: 507 chars
[Log] 📝 Building initial streaming: 530 chars
[Log] 📝 Initial streaming update: 530 chars
[Log] 📝 Building initial streaming: 557 chars
[Log] 📝 Initial streaming update: 557 chars
[Log] 📝 Building initial streaming: 608 chars
[Log] 📝 Initial streaming update: 608 chars
[Log] 📝 Building initial streaming: 643 chars
[Log] 📝 Initial streaming update: 643 chars
[Log] 📝 Building initial streaming: 687 chars
[Log] 📝 Initial streaming update: 687 chars
[Log] 📝 Building initial streaming: 714 chars
[Log] 📝 Initial streaming update: 714 chars
[Log] 📝 Building initial streaming: 761 chars
[Log] 📝 Initial streaming update: 761 chars
[Log] 📝 Building initial streaming: 807 chars
[Log] 📝 Initial streaming update: 807 chars
[Log] 📝 Building initial streaming: 820 chars
[Log] 📝 Initial streaming update: 820 chars
[Log] 📝 Building initial streaming: 847 chars
[Log] 📝 Initial streaming update: 847 chars
[Log] 📝 Building initial streaming: 877 chars
[Log] 📝 Initial streaming update: 877 chars
[Log] 📝 Building initial streaming: 896 chars
[Log] 📝 Initial streaming update: 896 chars
[Log] 📝 Building initial streaming: 924 chars
[Log] 📝 Initial streaming update: 924 chars
[Log] 📝 Building initial streaming: 961 chars
[Log] 📝 Initial streaming update: 961 chars
[Log] 📝 Building initial streaming: 987 chars
[Log] 📝 Initial streaming update: 987 chars
[Log] 📝 Building initial streaming: 1038 chars
[Log] 📝 Initial streaming update: 1038 chars
[Log] 📝 Building initial streaming: 1073 chars
[Log] 📝 Initial streaming update: 1073 chars
[Log] 📝 Building initial streaming: 1125 chars
[Log] 📝 Initial streaming update: 1125 chars
[Log] 📝 Building initial streaming: 1139 chars
[Log] 📝 Initial streaming update: 1139 chars
[Log] 📝 Building initial streaming: 1189 chars
[Log] 📝 Initial streaming update: 1189 chars
[Log] 📝 Building initial streaming: 1203 chars
[Log] 📝 Initial streaming update: 1203 chars
[Log] 🔍 State check on tool_start: – {messagePhase: "initial", activeMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", streamingMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", …}
{messagePhase: "initial", activeMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", streamingMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", phaseTransitions: 1}Object
[Log] 🔧 Tool started: generate_graph_data in phase initial
[Log] ✅ Completing initial streaming message: 1203 chars
[Log] Streaming message update: – {id: "611dce0f-f3aa-457c-a781-2a0336319e42", sessionId: "d8bed35a-193e-44db-a2a7-7582593c05b7", timestamp: "2025-06-23T05:54:54.519Z", …}
{id: "611dce0f-f3aa-457c-a781-2a0336319e42", sessionId: "d8bed35a-193e-44db-a2a7-7582593c05b7", timestamp: "2025-06-23T05:54:54.519Z", role: "assistant", content: "Let me provide a comprehensive analysis of the cre…visualizations to better illustrate these trends.", …}Object
[Log] 🔧 Tool generate_graph_data (toolu_01BHDrWUb6V7whnRRW3MAJgs) in progress
[Log] Sending POST request to http://localhost:8000/api/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7/generate-followups?limit=3
[Log] Sending POST request to http://localhost:8000/api/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7/generate-followups?limit=3
[Log] Generated 3 follow-up questions for conversation d8bed35a-193e-44db-a2a7-7582593c05b7 (x2)
[Log] 🔍 State check on tool_start: – {messagePhase: "tools", activeMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", streamingMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", …}
{messagePhase: "tools", activeMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", streamingMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", phaseTransitions: 2}Object
[Log] 🔧 Tool started: generate_table_data in phase tools
[Log] ⚠️ Tool started in phase tools - not completing initial message
[Log] 🔧 Tool generate_table_data (toolu_01P33jUDJs7fFh6E5BGubkYm) in progress
[Log] 🔍 State check on tool_start: – {messagePhase: "tools", activeMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", streamingMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", …}
{messagePhase: "tools", activeMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", streamingMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", phaseTransitions: 2}Object
[Log] 🔧 Tool started: generate_financial_metric in phase tools
[Log] ⚠️ Tool started in phase tools - not completing initial message
[Log] 🔧 Tool generate_financial_metric (toolu_0156rT2W6qKEkyL5r9Mt2k46) in progress
[Log] 🔍 State check on tool_start: – {messagePhase: "tools", activeMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", streamingMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", …}
{messagePhase: "tools", activeMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", streamingMessageId: "611dce0f-f3aa-457c-a781-2a0336319e42", phaseTransitions: 2}Object
[Log] 🔧 Tool started: generate_financial_metric in phase tools
[Log] ⚠️ Tool started in phase tools - not completing initial message
[Log] 🔧 Tool generate_financial_metric (toolu_01MV2iuDwEzoLzKieuNz3FAt) in progress
[Log] 📊 Transitioning to post-tools phase
[Log] 💬 Building post-visualization content: 3 chars
[Log] 📊 Post-visualization content update: 3 chars
[Log] 💬 Building post-visualization content: 14 chars
[Log] 📊 Post-visualization content update: 14 chars
[Log] 💬 Building post-visualization content: 43 chars
[Log] 📊 Post-visualization content update: 43 chars
[Log] 💬 Building post-visualization content: 69 chars
[Log] 📊 Post-visualization content update: 69 chars
[Log] 💬 Building post-visualization content: 113 chars
[Log] 📊 Post-visualization content update: 113 chars
[Log] 💬 Building post-visualization content: 157 chars
[Log] 📊 Post-visualization content update: 157 chars
[Log] 💬 Building post-visualization content: 185 chars
[Log] 📊 Post-visualization content update: 185 chars
[Log] 💬 Building post-visualization content: 212 chars
[Log] 📊 Post-visualization content update: 212 chars
[Log] 💬 Building post-visualization content: 241 chars
[Log] 📊 Post-visualization content update: 241 chars
[Log] 💬 Building post-visualization content: 288 chars
[Log] 📊 Post-visualization content update: 288 chars
[Log] 💬 Building post-visualization content: 313 chars
[Log] 📊 Post-visualization content update: 313 chars
[Log] 💬 Building post-visualization content: 353 chars
[Log] 📊 Post-visualization content update: 353 chars
[Log] 💬 Building post-visualization content: 377 chars
[Log] 📊 Post-visualization content update: 377 chars
[Log] 💬 Building post-visualization content: 407 chars
[Log] 📊 Post-visualization content update: 407 chars
[Log] 💬 Building post-visualization content: 444 chars
[Log] 📊 Post-visualization content update: 444 chars
[Log] 💬 Building post-visualization content: 472 chars
[Log] 📊 Post-visualization content update: 472 chars
[Log] 💬 Building post-visualization content: 502 chars
[Log] 📊 Post-visualization content update: 502 chars
[Log] 💬 Building post-visualization content: 537 chars
[Log] 📊 Post-visualization content update: 537 chars
[Log] 💬 Building post-visualization content: 571 chars
[Log] 📊 Post-visualization content update: 571 chars
[Log] 💬 Building post-visualization content: 611 chars
[Log] 📊 Post-visualization content update: 611 chars
[Log] 💬 Building post-visualization content: 657 chars
[Log] 📊 Post-visualization content update: 657 chars
[Log] 💬 Building post-visualization content: 694 chars
[Log] 📊 Post-visualization content update: 694 chars
[Log] 💬 Building post-visualization content: 735 chars
[Log] 📊 Post-visualization content update: 735 chars
[Log] 💬 Building post-visualization content: 782 chars
[Log] 📊 Post-visualization content update: 782 chars
[Log] 💬 Building post-visualization content: 818 chars
[Log] 📊 Post-visualization content update: 818 chars
[Log] 💬 Building post-visualization content: 851 chars
[Log] 📊 Post-visualization content update: 851 chars
[Log] 💬 Building post-visualization content: 859 chars
[Log] 📊 Post-visualization content update: 859 chars
[Log] 🏁 Message complete in phase: post-tools
[Log] Sending GET request to http://localhost:8000/api/conversation/message/611dce0f-f3aa-457c-a781-2a0336319e42
[Log] 📊 DB Message: 0 visualizations
[Log] 💬 Post-viz text: 859 chars
[Log] 📊 Local visualizations: 0 charts, 0 tables, 0 metrics
[Log] 📍 Current phase: post-tools, Tools started: true
[Log] ⚠️ Post-tools phase with text but no DB visualizations - creating messages anyway
[Log] 💬 Creating standalone post-visualization message: 859 chars
[Log] Streaming message update: – {id: "post_viz_1750658138000_9fzk4ksl2", sessionId: "d8bed35a-193e-44db-a2a7-7582593c05b7", timestamp: "2025-06-23T05:55:38.000Z", …}
{id: "post_viz_1750658138000_9fzk4ksl2", sessionId: "d8bed35a-193e-44db-a2a7-7582593c05b7", timestamp: "2025-06-23T05:55:38.000Z", role: "assistant", content: "Key Takeaways:↵1. While loan growth remains positi…vels don't indicate severe credit quality issues.", …}Object
[Log] 🧹 Cleaning up after phase transitions: initial → tools → post-tools
[Log] Sending POST request to http://localhost:8000/api/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7/generate-followups?limit=3
[Log] Sending POST request to http://localhost:8000/api/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7/generate-followups?limit=3
[Log] Generated 3 follow-up questions for conversation d8bed35a-193e-44db-a2a7-7582593c05b7 (x2)
</JavaScript_Console_Output>

<Backend_Logs>
(venv) alexcardell@Alexs-MacBook-Pro backend % cd /Users/alexcardell/AlexCoding_Local/cfin/backend && PYTHONPATH=$PYTHONPATH:/Users/alexcardell/AlexCoding_Local/cfin/backend python -m uvicorn app.main:app --reload --port 8000
INFO:     Will watch for changes in these directories: ['/Users/alexcardell/AlexCoding_Local/cfin/backend']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [44441] using StatReload
INFO:root:Loaded environment variables from /Users/alexcardell/AlexCoding_Local/cfin/.env
INFO:root:ANTHROPIC_API_KEY loaded: sk-ant-a...TQAA
INFO:app.main:CORS: Allowing origins: ['http://localhost:3000', 'http://localhost:3001', 'http://localhost:3002', 'http://localhost:3003', 'http://127.0.0.1:3000', 'http://127.0.0.1:3001', 'http://127.0.0.1:3002', 'http://127.0.0.1:3003', 'http://127.0.0.1:49937', 'http://127\\.0\\.0\\.1:\\d+', 'http://127.0.0.1:64142']
INFO:     Started server process [44443]
INFO:     Waiting for application startup.
INFO:app.main:Initializing database...
INFO:utils.init_db:Creating database tables...
INFO:utils.init_db:Database tables created successfully.
INFO:utils.init_db:Default user already exists.
INFO:utils.init_db:Database initialization completed successfully.
INFO:app.main:Database initialization completed successfully
INFO:     Application startup complete.
INFO:     127.0.0.1:62802 - "OPTIONS /api/conversation HTTP/1.1" 200 OK
INFO:     127.0.0.1:62803 - "OPTIONS /api/conversation HTTP/1.1" 200 OK
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.conversation:Created conversation: d8bed35a-193e-44db-a2a7-7582593c05b7 for user: default-user
INFO:app.routes.conversation:Created conversation: 829786ef-0823-4104-9b6d-81ff1e14ba26 for user: default-user
INFO:     127.0.0.1:62802 - "POST /api/conversation HTTP/1.1" 201 Created
INFO:     127.0.0.1:62803 - "POST /api/conversation HTTP/1.1" 201 Created
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     127.0.0.1:62802 - "GET /api/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7 HTTP/1.1" 200 OK
INFO:app.routes.websocket:WebSocket endpoint called for conversation: d8bed35a-193e-44db-a2a7-7582593c05b7, user: default-user
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     ('127.0.0.1', 62803) - "WebSocket /ws/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7" [accepted]
INFO:app.routes.websocket:WebSocket connected: default-user_d8bed35a-193e-44db-a2a7-7582593c05b7_1750658017489
INFO:app.routes.websocket:WebSocket connection established for conversation: d8bed35a-193e-44db-a2a7-7582593c05b7
INFO:     connection open
INFO:app.routes.websocket:Found conversation: d8bed35a-193e-44db-a2a7-7582593c05b7
INFO:     127.0.0.1:62804 - "OPTIONS /api/documents/upload HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:utils.storage:File 1340da4f-0a74-4e7f-a24b-489a6d92ee61.pdf saved to ./uploads/1340da4f-0a74-4e7f-a24b-489a6d92ee61.pdf
INFO:     127.0.0.1:62804 - "POST /api/documents/upload HTTP/1.1" 200 OK
INFO:pdf_processing.document_service:Starting optimized processing of document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 (Bank_5Q_Trend_Report.pdf) with Claude Files API
INFO:pdf_processing.document_service:No cached file_id for document 1340da4f-0a74-4e7f-a24b-489a6d92ee61, performing full processing
INFO:pdf_processing.api_service:Processing PDF: Bank_5Q_Trend_Report.pdf with Claude API using native PDF support.
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/files "HTTP/1.1 200 OK"
INFO:utils.file_cache:Cached file_id=file_011CQQdjLdUpax3mLxHWvDUj for content hash=9c15100a12f1a9ad... (expires: 2025-09-21 00:53:51, cache size: 1)
INFO:audit.pdf_access:PDF_ACCESS: {'timestamp': 'AUTO', 'operation': 'upload', 'file_id': 'file_011CQQdjLdUpax3mLxHWvDUj', 'user_context': 'system', 'file_size_bytes': 29802, 'privacy_note': 'PDF content not logged for compliance'}
INFO:pdf_processing.claude_file_client:Uploaded Bank_5Q_Trend_Report.pdf (0.0 MB) → file_011CQQdjLdUpax3mLxHWvDUj
INFO:pdf_processing.api_service:Generated Claude file_id file_011CQQdjLdUpax3mLxHWvDUj for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Analyzing document type for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Analyzing document type for Bank_5Q_Trend_Report.pdf using file_id=file_011CQQdjLdUpax3mLxHWvDUj
INFO:pdf_processing.model_router:Using Haiku for light tools set() with 1000 tokens (haiku_calls=1, sonnet_calls=0)
INFO:pdf_processing.api_service:Model router selected claude-3-5-haiku-20241022 for document type analysis
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (non-streaming): 117 (Custom estimate: 117)
INFO:pdf_processing.api_service:Throttling based on token count: 117 (SDK count: 117, Custom estimate: 117)
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Document Bank_5Q_Trend_Report.pdf classified as integrated_financial_report with periods: ['2024Q1', '2024Q2', '2024Q3', '2024Q4', '2025Q1']
INFO:pdf_processing.api_service:Document Bank_5Q_Trend_Report.pdf classified as: integrated_financial_report with periods: ['2024Q1', '2024Q2', '2024Q3', '2024Q4', '2025Q1']
INFO:pdf_processing.api_service:Extracting structured financial data and citations for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Extracting structured financial data with citations from: Bank_5Q_Trend_Report.pdf using file_id file_011CQQdjLdUpax3mLxHWvDUj
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (non-streaming): 181 (Custom estimate: 107)
INFO:pdf_processing.api_service:Throttling based on token count: 181 (SDK count: 181, Custom estimate: 107)
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Successfully parsed financial JSON from Claude's response.
INFO:pdf_processing.api_service:Captured Claude's preamble text, length: 240
INFO:pdf_processing.api_service:Extracted 0 citations for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Structured financial data keys for Bank_5Q_Trend_Report.pdf: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json']
INFO:pdf_processing.api_service:Added claude_file_id file_011CQQdjLdUpax3mLxHWvDUj to extracted_data for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.document_service:Processed document using Files API: PDF Bank_5Q_Trend_Report.pdf processed using Claude's native PDF support via Files API
INFO:pdf_processing.document_service:Extracted claude_file_id file_011CQQdjLdUpax3mLxHWvDUj from processed document data
INFO:pdf_processing.document_service:Stored claude_file_id file_011CQQdjLdUpax3mLxHWvDUj in database for document 1340da4f-0a74-4e7f-a24b-489a6d92ee61
INFO:pdf_processing.document_service:Updating document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 content with Claude optimizations using Files API
INFO:pdf_processing.document_service:Document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 processed with Claude optimizations. File ID: file_011CQQdjLdUpax3mLxHWvDUj
INFO:pdf_processing.document_service:Storing 0 citations for document 1340da4f-0a74-4e7f-a24b-489a6d92ee61
INFO:pdf_processing.document_service:Successfully completed optimized processing for document 1340da4f-0a74-4e7f-a24b-489a6d92ee61
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 accepted for financial analysis
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61/check-financial-data HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 accepted for financial analysis
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61/check-financial-data HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "OPTIONS /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61/verify-financial-data HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 has extracted_data with keys: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json', 'claude_file_id']
INFO:     127.0.0.1:62804 - "POST /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61/verify-financial-data HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62804 - "OPTIONS /api/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7/document/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     127.0.0.1:62804 - "POST /api/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7/document/1340da4f-0a74-4e7f-a24b-489a6d92ee61 HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Retrieving file for document: 1340da4f-0a74-4e7f-a24b-489a6d92ee61
INFO:app.routes.document:Returning binary PDF data for document 1340da4f-0a74-4e7f-a24b-489a6d92ee61, size: 29802 bytes
INFO:     127.0.0.1:62804 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61/file HTTP/1.1" 200 OK
INFO:     127.0.0.1:62818 - "GET /api/documents/1340da4f-0a74-4e7f-a24b-489a6d92ee61/citations HTTP/1.1" 200 OK
INFO:app.routes.websocket:WEBSOCKET_FLOW: Created streaming session default-user_d8bed35a-193e-44db-a2a7-7582593c05b7_1750658017489_d8bed35a-193e-44db-a2a7-7582593c05b7 with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: Sent initial message_start event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: Starting conversation processing for conversation: d8bed35a-193e-44db-a2a7-7582593c05b7
INFO:repositories.document_repository:Retrieving document content using file path: 1340da4f-0a74-4e7f-a24b-489a6d92ee61.pdf
INFO:repositories.document_repository:Requesting file from storage service for document 1340da4f-0a74-4e7f-a24b-489a6d92ee61
INFO:repositories.document_repository:Retrieved PDF content for document 1340da4f-0a74-4e7f-a24b-489a6d92ee61: 29802 bytes
INFO:repositories.document_repository:Document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 has claude_file_id: file_011CQQdjLdUpax3mLxHWvDUj (native PDF support available)
INFO:repositories.document_repository:PDF document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 uses claude_file_id for native support - raw_text not required
INFO:repositories.document_repository:Extracted data available for document 1340da4f-0a74-4e7f-a24b-489a6d92ee61: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json', 'claude_file_id']
INFO:repositories.document_repository:Successfully retrieved content for document 1340da4f-0a74-4e7f-a24b-489a6d92ee61
INFO:services.conversation_service:Retrieved content for document 1340da4f-0a74-4e7f-a24b-489a6d92ee61: content size=29802, raw_text size=0
INFO:services.conversation_service:Document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 available content types: content, extracted_data
INFO:services.conversation_service:Added document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 to context for conversation d8bed35a-193e-44db-a2a7-7582593c05b7
INFO:repositories.document_repository:Retrieving document content using file path: 1340da4f-0a74-4e7f-a24b-489a6d92ee61.pdf
INFO:repositories.document_repository:Requesting file from storage service for document 1340da4f-0a74-4e7f-a24b-489a6d92ee61
INFO:repositories.document_repository:Retrieved PDF content for document 1340da4f-0a74-4e7f-a24b-489a6d92ee61: 29802 bytes
INFO:repositories.document_repository:Document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 has claude_file_id: file_011CQQdjLdUpax3mLxHWvDUj (native PDF support available)
INFO:repositories.document_repository:PDF document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 uses claude_file_id for native support - raw_text not required
INFO:repositories.document_repository:Extracted data available for document 1340da4f-0a74-4e7f-a24b-489a6d92ee61: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json', 'claude_file_id']
INFO:repositories.document_repository:Successfully retrieved content for document 1340da4f-0a74-4e7f-a24b-489a6d92ee61
INFO:services.conversation_service:Added document 1340da4f-0a74-4e7f-a24b-489a6d92ee61 with Files API file_id: file_011CQQdjLdUpax3mLxHWvDUj
INFO:services.conversation_service:Using unified streaming approach with tools available for conversation d8bed35a-193e-44db-a2a7-7582593c05b7
INFO:services.conversation_service:Using Files API claude_file_id file_011CQQdjLdUpax3mLxHWvDUj for unified streaming analysis
INFO:pdf_processing.api_service:Starting streaming analyze_with_visualization_tools for query: 'How has credit performed?...'
INFO:pdf_processing.api_service:Streaming visualization analysis turn 1/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_graph_data', 'generate_table_data', 'generate_financial_metric', 'generate_comparative_period'} with 46 tokens (haiku_calls=1, sonnet_calls=1)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 4321 (Custom estimate: 39)
INFO:pdf_processing.api_service:Throttling based on token count: 4321 (SDK count: 4321, Custom estimate: 39)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
ERROR:sqlalchemy.pool.impl.NullPool:The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-36, started daemon 6173241344)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
/Users/alexcardell/AlexCoding_Local/venv/lib/python3.9/site-packages/pydantic/_internal/_known_annotated_metadata.py:390: SAWarning: The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-36, started daemon 6173241344)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
  res = {k: v for k, v in res.items() if v is not None}
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_start event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Filtering out duplicate message_start event for session default-user_d8bed35a-193e-44db-a2a7-7582593c05b7_1750658017489_d8bed35a-193e-44db-a2a7-7582593c05b7
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_start event
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 3 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 3
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 3 chars
INFO:services.conversation_service:📝 Content updated: 3 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 3 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 46 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 46
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 46 chars
INFO:services.conversation_service:📝 Content updated: 46 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 46 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 78 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 78
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 78 chars
INFO:services.conversation_service:📝 Content updated: 78 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 78 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 111 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 111
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 111 chars
INFO:services.conversation_service:📝 Content updated: 111 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 111 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 168 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 168
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 168 chars
INFO:services.conversation_service:📝 Content updated: 168 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 168 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 206 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 206
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 206 chars
INFO:services.conversation_service:📝 Content updated: 206 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 206 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 241 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 241
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 241 chars
INFO:services.conversation_service:📝 Content updated: 241 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 241 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 276 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 276
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 276 chars
INFO:services.conversation_service:📝 Content updated: 276 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 276 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 303 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 303
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 303 chars
INFO:services.conversation_service:📝 Content updated: 303 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 303 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 332 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 332
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 332 chars
INFO:services.conversation_service:📝 Content updated: 332 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 332 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 359 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 359
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 359 chars
INFO:services.conversation_service:📝 Content updated: 359 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 359 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 372 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 372
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 372 chars
INFO:services.conversation_service:📝 Content updated: 372 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 372 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 381 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 381
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 381 chars
INFO:services.conversation_service:📝 Content updated: 381 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 381 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 394 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 394
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 394 chars
INFO:services.conversation_service:📝 Content updated: 394 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 394 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 417 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 417
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 417 chars
INFO:services.conversation_service:📝 Content updated: 417 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 417 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 453 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 453
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 453 chars
INFO:services.conversation_service:📝 Content updated: 453 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 453 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 507 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 507
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 507 chars
INFO:services.conversation_service:📝 Content updated: 507 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 507 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 530 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 530
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 530 chars
INFO:services.conversation_service:📝 Content updated: 530 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 530 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 557 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 557
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 557 chars
INFO:services.conversation_service:📝 Content updated: 557 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 557 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 608 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 608
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 608 chars
INFO:services.conversation_service:📝 Content updated: 608 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 608 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 643 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 643
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 643 chars
INFO:services.conversation_service:📝 Content updated: 643 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 643 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 687 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 687
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 687 chars
INFO:services.conversation_service:📝 Content updated: 687 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 687 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 714 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 714
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 714 chars
INFO:services.conversation_service:📝 Content updated: 714 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 714 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 761 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 761
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 761 chars
INFO:services.conversation_service:📝 Content updated: 761 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 761 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 807 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 807
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 807 chars
INFO:services.conversation_service:📝 Content updated: 807 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 807 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 820 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 820
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 820 chars
INFO:services.conversation_service:📝 Content updated: 820 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 820 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 847 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 847
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 847 chars
INFO:services.conversation_service:📝 Content updated: 847 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 847 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 877 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 877
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 877 chars
INFO:services.conversation_service:📝 Content updated: 877 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 877 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 896 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 896
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 896 chars
INFO:services.conversation_service:📝 Content updated: 896 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 896 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 924 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 924
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 924 chars
INFO:services.conversation_service:📝 Content updated: 924 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 924 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 961 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 961
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 961 chars
INFO:services.conversation_service:📝 Content updated: 961 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 961 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 987 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 987
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 987 chars
INFO:services.conversation_service:📝 Content updated: 987 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 987 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 1038 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 1038
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 1038 chars
INFO:services.conversation_service:📝 Content updated: 1038 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 1038 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 1073 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 1073
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 1073 chars
INFO:services.conversation_service:📝 Content updated: 1073 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 1073 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 1125 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 1125
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 1125 chars
INFO:services.conversation_service:📝 Content updated: 1125 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 1125 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 1139 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 1139
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 1139 chars
INFO:services.conversation_service:📝 Content updated: 1139 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 1139 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 1189 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 1189
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 1189 chars
INFO:services.conversation_service:📝 Content updated: 1189 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 1189 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 1203 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 1203
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 1203 chars
INFO:services.conversation_service:📝 Content updated: 1203 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 1203 chars
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for content_block_stop event
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for tool_start event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_start event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_start - tool_id=toolu_01BHDrWUb6V7whnRRW3MAJgs, tool_name=generate_graph_data
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:pdf_processing.api_service:Sending request to Claude API with 1 messages, streaming: False
INFO:pdf_processing.api_service:Sending request to Claude API with 1 messages, streaming: False
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (generate_response non-streaming): 506
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (generate_response non-streaming): 506
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (non-streaming): 506 (Custom estimate: 533)
INFO:pdf_processing.api_service:Throttling based on token count: 506 (SDK count: 506, Custom estimate: 533)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (non-streaming): 506 (Custom estimate: 533)
INFO:pdf_processing.api_service:Throttling based on token count: 506 (SDK count: 506, Custom estimate: 533)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:     127.0.0.1:62834 - "POST /api/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7/generate-followups?limit=3 HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:     127.0.0.1:62835 - "POST /api/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7/generate-followups?limit=3 HTTP/1.1" 200 OK
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for content_block_stop event
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_delta event
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_stop event
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_graph_data: type=<class 'dict'>
WARNING:app.routes.websocket:Correcting message_id from msg_018HmaSKyD5V84zABhUQe9h3 to 611dce0f-f3aa-457c-a781-2a0336319e42 for tool_complete event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01BHDrWUb6V7whnRRW3MAJgs, tool_name=generate_graph_data
INFO:pdf_processing.api_service:Turn 1: Initial streaming text preserved (1203 chars)
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_graph_data (ID: toolu_01BHDrWUb6V7whnRRW3MAJgs)
INFO:pdf_processing.api_service:Processing streaming tool generate_graph_data (ID: toolu_01BHDrWUb6V7whnRRW3MAJgs)
INFO:pdf_processing.api_service:Tool generate_graph_data (ID: toolu_01BHDrWUb6V7whnRRW3MAJgs) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_graph_data (ID: toolu_01BHDrWUb6V7whnRRW3MAJgs) - dict input keys: ['chartType', 'config', 'data', 'chartConfig']
INFO:utils.tool_processing:Processing generate_graph_data (ID: toolu_01BHDrWUb6V7whnRRW3MAJgs) - input type: <class 'dict'>
INFO:utils.tool_processing:Starting process_chart_input with input type: <class 'dict'>
INFO:utils.tool_processing:Chart input keys: ['chartType', 'config', 'data', 'chartConfig']
INFO:utils.tool_processing:Chart config type: <class 'str'>
INFO:utils.tool_processing:Chart data type: <class 'list'>, length: 5
INFO:utils.tool_processing:Chart chartConfig type: <class 'dict'>
WARNING:utils.tool_processing:Chart config is a JSON string, parsing it
INFO:utils.tool_processing:Successfully parsed config JSON string
INFO:utils.tool_processing:Chart config keys: ['title', 'xAxisKey', 'xAxisLabel', 'yAxisLabel', 'description']
INFO:utils.tool_processing:Successfully got original_data: type=<class 'list'>
INFO:utils.tool_processing:Chart type: line
INFO:utils.tool_processing:Chart config settings type: <class 'dict'>
INFO:utils.tool_processing:x_axis_key: period
INFO:utils.tool_processing:Transforming chart data to {x, y} format required by ChartDataItem model
INFO:utils.tool_processing:Line chart with multiple series (['npa', 'allowance', 'pastDue']) - keeping flat format
INFO:utils.tool_processing:Successfully processed chart: Credit Quality Trends
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01BHDrWUb6V7whnRRW3MAJgs, tool_name=generate_graph_data
INFO:pdf_processing.api_service:Streaming visualization analysis turn 2/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_graph_data', 'generate_table_data', 'generate_financial_metric', 'generate_comparative_period'} with 904 tokens (haiku_calls=1, sonnet_calls=2)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 5424 (Custom estimate: 340)
INFO:pdf_processing.api_service:Throttling based on token count: 5424 (SDK count: 5424, Custom estimate: 340)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
WARNING:app.routes.websocket:Correcting message_id from msg_01LC5AzrdZ4Jvkdnah9N56qz to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_start event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Filtering out duplicate message_start event for session default-user_d8bed35a-193e-44db-a2a7-7582593c05b7_1750658017489_d8bed35a-193e-44db-a2a7-7582593c05b7
WARNING:app.routes.websocket:Correcting message_id from msg_01LC5AzrdZ4Jvkdnah9N56qz to 611dce0f-f3aa-457c-a781-2a0336319e42 for tool_start event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_start event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_start - tool_id=toolu_01P33jUDJs7fFh6E5BGubkYm, tool_name=generate_table_data
WARNING:app.routes.websocket:Correcting message_id from msg_01LC5AzrdZ4Jvkdnah9N56qz to 611dce0f-f3aa-457c-a781-2a0336319e42 for content_block_stop event
WARNING:app.routes.websocket:Correcting message_id from msg_01LC5AzrdZ4Jvkdnah9N56qz to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_delta event
WARNING:app.routes.websocket:Correcting message_id from msg_01LC5AzrdZ4Jvkdnah9N56qz to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_stop event
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_table_data: type=<class 'dict'>
WARNING:app.routes.websocket:Correcting message_id from msg_01LC5AzrdZ4Jvkdnah9N56qz to 611dce0f-f3aa-457c-a781-2a0336319e42 for tool_complete event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01P33jUDJs7fFh6E5BGubkYm, tool_name=generate_table_data
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_table_data (ID: toolu_01P33jUDJs7fFh6E5BGubkYm)
INFO:pdf_processing.api_service:Processing streaming tool generate_table_data (ID: toolu_01P33jUDJs7fFh6E5BGubkYm)
INFO:pdf_processing.api_service:Tool generate_table_data (ID: toolu_01P33jUDJs7fFh6E5BGubkYm) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_table_data (ID: toolu_01P33jUDJs7fFh6E5BGubkYm) - dict input keys: ['tableType', 'config', 'data']
INFO:utils.tool_processing:Processing generate_table_data (ID: toolu_01P33jUDJs7fFh6E5BGubkYm) - input type: <class 'dict'>
INFO:utils.tool_processing:Starting process_table_input with input type: <class 'dict'>
INFO:utils.tool_processing:Table input keys: ['tableType', 'config', 'data']
INFO:utils.tool_processing:Table config type: <class 'str'>
INFO:utils.tool_processing:Table data type: <class 'list'>, length: 5
WARNING:utils.tool_processing:Table config is a JSON string, parsing it
INFO:utils.tool_processing:Successfully parsed table config JSON string
INFO:utils.tool_processing:Successfully processed table: Credit Performance Metrics
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01P33jUDJs7fFh6E5BGubkYm, tool_name=generate_table_data
INFO:pdf_processing.api_service:Streaming visualization analysis turn 3/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_graph_data', 'generate_table_data', 'generate_financial_metric', 'generate_comparative_period'} with 1567 tokens (haiku_calls=1, sonnet_calls=3)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 6472 (Custom estimate: 340)
INFO:pdf_processing.api_service:Throttling based on token count: 6472 (SDK count: 6472, Custom estimate: 340)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
WARNING:app.routes.websocket:Correcting message_id from msg_01L6mtVmrAYAnVPGwe1pjnTd to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_start event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Filtering out duplicate message_start event for session default-user_d8bed35a-193e-44db-a2a7-7582593c05b7_1750658017489_d8bed35a-193e-44db-a2a7-7582593c05b7
WARNING:app.routes.websocket:Correcting message_id from msg_01L6mtVmrAYAnVPGwe1pjnTd to 611dce0f-f3aa-457c-a781-2a0336319e42 for tool_start event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_start event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_start - tool_id=toolu_0156rT2W6qKEkyL5r9Mt2k46, tool_name=generate_financial_metric
WARNING:app.routes.websocket:Correcting message_id from msg_01L6mtVmrAYAnVPGwe1pjnTd to 611dce0f-f3aa-457c-a781-2a0336319e42 for content_block_stop event
WARNING:app.routes.websocket:Correcting message_id from msg_01L6mtVmrAYAnVPGwe1pjnTd to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_delta event
WARNING:app.routes.websocket:Correcting message_id from msg_01L6mtVmrAYAnVPGwe1pjnTd to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_stop event
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_financial_metric: type=<class 'dict'>
WARNING:app.routes.websocket:Correcting message_id from msg_01L6mtVmrAYAnVPGwe1pjnTd to 611dce0f-f3aa-457c-a781-2a0336319e42 for tool_complete event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_0156rT2W6qKEkyL5r9Mt2k46, tool_name=generate_financial_metric
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_financial_metric (ID: toolu_0156rT2W6qKEkyL5r9Mt2k46)
INFO:pdf_processing.api_service:Processing streaming tool generate_financial_metric (ID: toolu_0156rT2W6qKEkyL5r9Mt2k46)
INFO:pdf_processing.api_service:Tool generate_financial_metric (ID: toolu_0156rT2W6qKEkyL5r9Mt2k46) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_financial_metric (ID: toolu_0156rT2W6qKEkyL5r9Mt2k46) - dict input keys: ['category', 'name', 'period', 'value', 'unit', 'isEstimated']
INFO:utils.tool_processing:Processing generate_financial_metric (ID: toolu_0156rT2W6qKEkyL5r9Mt2k46) - input type: <class 'dict'>
INFO:utils.tool_processing:Successfully processed financial metric: Net Charge-off Rate
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_0156rT2W6qKEkyL5r9Mt2k46, tool_name=generate_financial_metric
INFO:pdf_processing.api_service:Streaming visualization analysis turn 4/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_graph_data', 'generate_table_data', 'generate_financial_metric', 'generate_comparative_period'} with 1682 tokens (haiku_calls=1, sonnet_calls=4)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 6685 (Custom estimate: 340)
INFO:pdf_processing.api_service:Throttling based on token count: 6685 (SDK count: 6685, Custom estimate: 340)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
WARNING:app.routes.websocket:Correcting message_id from msg_01J2rXnmDYeSNBNY44tHZmgj to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_start event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Filtering out duplicate message_start event for session default-user_d8bed35a-193e-44db-a2a7-7582593c05b7_1750658017489_d8bed35a-193e-44db-a2a7-7582593c05b7
WARNING:app.routes.websocket:Correcting message_id from msg_01J2rXnmDYeSNBNY44tHZmgj to 611dce0f-f3aa-457c-a781-2a0336319e42 for tool_start event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_start event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_start - tool_id=toolu_01MV2iuDwEzoLzKieuNz3FAt, tool_name=generate_financial_metric
WARNING:app.routes.websocket:Correcting message_id from msg_01J2rXnmDYeSNBNY44tHZmgj to 611dce0f-f3aa-457c-a781-2a0336319e42 for content_block_stop event
WARNING:app.routes.websocket:Correcting message_id from msg_01J2rXnmDYeSNBNY44tHZmgj to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_delta event
WARNING:app.routes.websocket:Correcting message_id from msg_01J2rXnmDYeSNBNY44tHZmgj to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_stop event
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_financial_metric: type=<class 'dict'>
WARNING:app.routes.websocket:Correcting message_id from msg_01J2rXnmDYeSNBNY44tHZmgj to 611dce0f-f3aa-457c-a781-2a0336319e42 for tool_complete event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01MV2iuDwEzoLzKieuNz3FAt, tool_name=generate_financial_metric
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_financial_metric (ID: toolu_01MV2iuDwEzoLzKieuNz3FAt)
INFO:pdf_processing.api_service:Processing streaming tool generate_financial_metric (ID: toolu_01MV2iuDwEzoLzKieuNz3FAt)
INFO:pdf_processing.api_service:Tool generate_financial_metric (ID: toolu_01MV2iuDwEzoLzKieuNz3FAt) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_financial_metric (ID: toolu_01MV2iuDwEzoLzKieuNz3FAt) - dict input keys: ['category', 'name', 'period', 'value', 'unit', 'isEstimated']
INFO:utils.tool_processing:Processing generate_financial_metric (ID: toolu_01MV2iuDwEzoLzKieuNz3FAt) - input type: <class 'dict'>
INFO:utils.tool_processing:Successfully processed financial metric: Non-Performing Assets Ratio
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01MV2iuDwEzoLzKieuNz3FAt, tool_name=generate_financial_metric
INFO:pdf_processing.api_service:Streaming visualization analysis turn 5/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_graph_data', 'generate_table_data', 'generate_financial_metric', 'generate_comparative_period'} with 1801 tokens (haiku_calls=1, sonnet_calls=5)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 6900 (Custom estimate: 340)
INFO:pdf_processing.api_service:Throttling based on token count: 6900 (SDK count: 6900, Custom estimate: 340)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_start event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Filtering out duplicate message_start event for session default-user_d8bed35a-193e-44db-a2a7-7582593c05b7_1750658017489_d8bed35a-193e-44db-a2a7-7582593c05b7
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_start event
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 3 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 3
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 3 chars
INFO:services.conversation_service:📝 Content updated: 3 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 3 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 14 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 14
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 14 chars
INFO:services.conversation_service:📝 Content updated: 14 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 14 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 43 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 43
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 43 chars
INFO:services.conversation_service:📝 Content updated: 43 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 43 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 69 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 69
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 69 chars
INFO:services.conversation_service:📝 Content updated: 69 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 69 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 113 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 113
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 113 chars
INFO:services.conversation_service:📝 Content updated: 113 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 113 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 157 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 157
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 157 chars
INFO:services.conversation_service:📝 Content updated: 157 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 157 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 185 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 185
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 185 chars
INFO:services.conversation_service:📝 Content updated: 185 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 185 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 212 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 212
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 212 chars
INFO:services.conversation_service:📝 Content updated: 212 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 212 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 241 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 241
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 241 chars
INFO:services.conversation_service:📝 Content updated: 241 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 241 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 288 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 288
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 288 chars
INFO:services.conversation_service:📝 Content updated: 288 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 288 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 313 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 313
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 313 chars
INFO:services.conversation_service:📝 Content updated: 313 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 313 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 353 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 353
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 353 chars
INFO:services.conversation_service:📝 Content updated: 353 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 353 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 377 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 377
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 377 chars
INFO:services.conversation_service:📝 Content updated: 377 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 377 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 407 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 407
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 407 chars
INFO:services.conversation_service:📝 Content updated: 407 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 407 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 444 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 444
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 444 chars
INFO:services.conversation_service:📝 Content updated: 444 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 444 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 472 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 472
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 472 chars
INFO:services.conversation_service:📝 Content updated: 472 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 472 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 502 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 502
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 502 chars
INFO:services.conversation_service:📝 Content updated: 502 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 502 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 537 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 537
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 537 chars
INFO:services.conversation_service:📝 Content updated: 537 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 537 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 571 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 571
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 571 chars
INFO:services.conversation_service:📝 Content updated: 571 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 571 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 611 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 611
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 611 chars
INFO:services.conversation_service:📝 Content updated: 611 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 611 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 657 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 657
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 657 chars
INFO:services.conversation_service:📝 Content updated: 657 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 657 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 694 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 694
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 694 chars
INFO:services.conversation_service:📝 Content updated: 694 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 694 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 735 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 735
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 735 chars
INFO:services.conversation_service:📝 Content updated: 735 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 735 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 782 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 782
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 782 chars
INFO:services.conversation_service:📝 Content updated: 782 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 782 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 818 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 818
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 818 chars
INFO:services.conversation_service:📝 Content updated: 818 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 818 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 851 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 851
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 851 chars
INFO:services.conversation_service:📝 Content updated: 851 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 851 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for text_delta event
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 859 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 859
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 859 chars
INFO:services.conversation_service:📝 Content updated: 859 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 859 chars
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for content_block_stop event
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_delta event
WARNING:app.routes.websocket:Correcting message_id from msg_01GYbpLgKYbyj1vV5sjmNoX2 to 611dce0f-f3aa-457c-a781-2a0336319e42 for message_stop event
INFO:pdf_processing.api_service:Turn 5: Adding new content (859 chars)
INFO:pdf_processing.api_service:Streaming visualization analysis completed: no more tools
INFO:pdf_processing.api_service:Streaming visualization analysis completed: 1 charts, 1 tables, 2 metrics. Analysis text length: 2064
INFO:services.conversation_service:Current assistant message content length: 859
INFO:services.conversation_service:Analysis text length: 2064
INFO:services.conversation_service:📝 Using streaming content (859 chars)
INFO:repositories.conversation_repository:Updated and re-fetched message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:repositories.conversation_repository:Message content length: 859
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 859 chars
INFO:services.conversation_service:✅ Database updated with final content: 859 chars
INFO:services.conversation_service:Sent message_update event for 611dce0f-f3aa-457c-a781-2a0336319e42 after streaming complete
INFO:services.conversation_service:DEBUG: result.get('metrics'): [{'category': 'Credit Quality', 'name': 'Net Charge-off Rate', 'period': '2025Q1', 'value': 0.071, 'unit': '%', 'isEstimated': True}, {'category': 'Credit Quality', 'name': 'Non-Performing Assets Ratio', 'period': '2025Q1', 'value': 0.867, 'unit': '%', 'isEstimated': True}]
INFO:services.conversation_service:DEBUG: accumulated_metrics: [{'category': 'Credit Quality', 'name': 'Net Charge-off Rate', 'period': '2025Q1', 'value': 0.071, 'unit': '%', 'isEstimated': True}, {'category': 'Credit Quality', 'name': 'Non-Performing Assets Ratio', 'period': '2025Q1', 'value': 0.867, 'unit': '%', 'isEstimated': True}]
INFO:services.conversation_service:Processing visualizations for conversation d8bed35a-193e-44db-a2a7-7582593c05b7: charts=1, tables=1, metrics=2
INFO:services.conversation_service:Processing chart: Credit Quality Trends
INFO:services.conversation_service:Processing table: Credit Performance Metrics
INFO:services.conversation_service:Processing metric: Net Charge-off Rate
INFO:services.conversation_service:Processing metric: Non-Performing Assets Ratio
INFO:services.conversation_service:Storing 4 analysis blocks for streaming message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:services.conversation_service:ATOMIC: Using existing transaction for message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:services.conversation_service:ATOMIC: Refreshed message 611dce0f-f3aa-457c-a781-2a0336319e42 content length: 859 chars
INFO:repositories.conversation_repository:Added analysis block 'Credit Quality Trends' (type: chart) to message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:services.conversation_service:ATOMIC: Stored analysis block 1/4: Credit Quality Trends
INFO:repositories.conversation_repository:Added analysis block 'Credit Performance Metrics' (type: table) to message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:services.conversation_service:ATOMIC: Stored analysis block 2/4: Credit Performance Metrics
INFO:repositories.conversation_repository:Added analysis block 'Net Charge-off Rate' (type: metric) to message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:services.conversation_service:ATOMIC: Stored analysis block 3/4: Net Charge-off Rate
INFO:repositories.conversation_repository:Added analysis block 'Non-Performing Assets Ratio' (type: metric) to message 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:services.conversation_service:ATOMIC: Stored analysis block 4/4: Non-Performing Assets Ratio
INFO:services.conversation_service:ATOMIC: Transaction complete - message 611dce0f-f3aa-457c-a781-2a0336319e42 has 4 analysis blocks
INFO:services.conversation_service:Sending message_complete event for conversation d8bed35a-193e-44db-a2a7-7582593c05b7 after analysis blocks stored
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting message_complete event with message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: Marking session default-user_d8bed35a-193e-44db-a2a7-7582593c05b7_1750658017489_d8bed35a-193e-44db-a2a7-7582593c05b7 as inactive after message_complete
INFO:services.conversation_service:message_complete event sent for conversation d8bed35a-193e-44db-a2a7-7582593c05b7 after analysis blocks
INFO:app.routes.websocket:WEBSOCKET_FLOW: Streaming message processing completed for message_id: 611dce0f-f3aa-457c-a781-2a0336319e42
INFO:app.routes.websocket:WEBSOCKET_FLOW: Conversation d8bed35a-193e-44db-a2a7-7582593c05b7 processing finished successfully
INFO:app.routes.websocket:WEBSOCKET_FLOW: Cleaning up session default-user_d8bed35a-193e-44db-a2a7-7582593c05b7_1750658017489_d8bed35a-193e-44db-a2a7-7582593c05b7
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     127.0.0.1:62840 - "GET /api/conversation/message/611dce0f-f3aa-457c-a781-2a0336319e42 HTTP/1.1" 200 OK
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:pdf_processing.api_service:Sending request to Claude API with 1 messages, streaming: False
INFO:pdf_processing.api_service:Sending request to Claude API with 1 messages, streaming: False
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (generate_response non-streaming): 403
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (generate_response non-streaming): 403
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (non-streaming): 403 (Custom estimate: 447)
INFO:pdf_processing.api_service:Throttling based on token count: 403 (SDK count: 403, Custom estimate: 447)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (non-streaming): 403 (Custom estimate: 447)
INFO:pdf_processing.api_service:Throttling based on token count: 403 (SDK count: 403, Custom estimate: 447)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:     127.0.0.1:62840 - "POST /api/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7/generate-followups?limit=3 HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:     127.0.0.1:62841 - "POST /api/conversation/d8bed35a-193e-44db-a2a7-7582593c05b7/generate-followups?limit=3 HTTP/1.1" 200 OK
</Backend_Logs>