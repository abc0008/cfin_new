<Initial_Streaming_Response>

Let me provide a comprehensive analysis of deposit performance based on the financial statements.

The bank's deposit performance shows steady growth across all deposit categories from 2024Q1 through 2025Q1. Total deposits have grown from $46,000M to $47,700M, representing a 3.7% increase over the five quarters.

Key observations from the deposit trends:
1. Money Market (MMDA) accounts remain the largest deposit category, growing from $14,960M to $15,400M
2. Non-interest DDA (demand deposit accounts) show consistent growth from $12,000M to $12,700M
3. All deposit categories demonstrate stable, incremental growth quarter over quarter
4. The deposit mix remains relatively stable, indicating successful retention across all product types

Let me provide detailed visualizations to better illustrate these trends:








</Initial_Streaming_Response>

<Post_Visualization_Streaming_Response>


The visualizations and metrics above show:
1. A consistent upward trend in total deposits with accelerating growth in later quarters
2. Money Market accounts maintaining their position as the largest deposit category
3. Healthy quarter-over-quarter growth rates, with the strongest growth occurring in 2024Q4 at 1.29%
4. A relatively stable deposit mix, indicating good retention across all deposit types

The deposit performance suggests effective deposit gathering strategies and stable funding sources for the bank's operations. The growth trend is particularly positive given it spans across all deposit categories, indicating broad-based customer confidence and successful deposit retention strategies.

</Post_Visualization_Streaming_Response>

<JavaScript_Console_Output>
[Info] Successfully preconnected to https://fonts.googleapis.com/
[Info] Successfully preconnected to https://fonts.gstatic.com/
[Error] Failed to load resource: the server responded with a status of 400 () (font, line 0)
[Error] Failed to load resource: the server responded with a status of 400 () (font, line 0)
[Log] ğŸŒ API Service Available
[Log] Use __apiService to access the API directly in the console
[Log] Sending POST request to http://localhost:8000/api/conversation
[Log] Sending POST request to http://localhost:8000/api/conversation
[Log] Created conversation session: 0869c945-1f6f-4132-96af-b988bf4a3490
[Log] Created conversation session: 65107daf-b0b4-4a90-849e-db9e78ad56db
[Log] Created conversation session: â€“ "65107daf-b0b4-4a90-849e-db9e78ad56db"
[Log] Validating conversation exists: â€“ "65107daf-b0b4-4a90-849e-db9e78ad56db"
[Log] Sending GET request to http://localhost:8000/api/conversation/65107daf-b0b4-4a90-849e-db9e78ad56db
[Log] Starting WebSocket connection to: â€“ "ws://localhost:8000/ws/conversation/65107daf-b0b4-4a90-849e-db9e78ad56db"
[Log] Current isConnected state before connection: â€“ false
[Log] WebSocket onopen event fired for conversation: â€“ "65107daf-b0b4-4a90-849e-db9e78ad56db"
[Log] WebSocket connected and isConnected set to true for conversation: â€“ "65107daf-b0b4-4a90-849e-db9e78ad56db"
[Log] File selected: â€“ "Bank_5Q_Trend_Report.pdf"
[Log] Validating file: â€“ "Bank_5Q_Trend_Report.pdf"
[Log] File validation successful
[Log] Uploading document...
[Log] Upload progress: 0.00%, Stage: Starting upload
[Log] Uploading file to http://localhost:8000/api/documents/upload
[Log] Upload progress: 40.00%, Stage: Uploading file
[Log] Polling for document processing completion...
[Log] Upload progress: 40.00%, Stage: Processing document
[Log] Upload progress: 40.00%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 1: processing
[Log] Upload progress: 40.27%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 2: processing
[Log] Upload progress: 40.53%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 3: processing
[Log] Upload progress: 40.80%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 4: processing
[Log] Upload progress: 41.07%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 5: processing
[Log] Upload progress: 41.33%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 6: processing
[Log] Upload progress: 41.60%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 7: processing
[Log] Upload progress: 41.87%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 8: processing
[Log] Upload progress: 42.13%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 9: processing
[Log] Upload progress: 42.40%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 10: processing
[Log] Upload progress: 42.67%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 11: processing
[Log] Upload progress: 42.93%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 12: processing
[Log] Upload progress: 43.20%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 13: processing
[Log] Upload progress: 43.47%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 14: processing
[Log] Upload progress: 43.73%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 15: processing
[Log] Upload progress: 44.00%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 16: processing
[Log] Upload progress: 44.27%, Stage: Processing document
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document status after attempt 17: completed
[Log] Verifying financial data...
[Log] Upload progress: 80.00%, Stage: Verifying financial data
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca/check-financial-data
[Log] Document needs financial data verification: â€“ "Document accepted for financial analysis"
[Log] Upload progress: 85.00%, Stage: Enhancing financial data
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca/check-financial-data
[Log] Sending POST request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca/verify-financial-data
[Log] Financial data verification result: â€“ {success: true, message: "Document content verified for analysis"}
[Log] Upload progress: 90.00%, Stage: Retrieving enhanced data
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Upload progress: 100.00%, Stage: Document ready
[Log] Document verification completed: â€“ {metadata: Object, contentType: "other", extractionTimestamp: "2025-06-20T20:42:56.760Z", â€¦}
{metadata: Object, contentType: "other", extractionTimestamp: "2025-06-20T20:42:56.760Z", periods: ["2024Q1", "2024Q2", "2024Q3", "2024Q4", "2025Q1"], extractedData: Object, â€¦}Object
[Log] Associating document 148a3c61-54cf-490a-a782-cbf6b9a787ca with conversation 65107daf-b0b4-4a90-849e-db9e78ad56db
[Log] Sending POST request to http://localhost:8000/api/conversation/65107daf-b0b4-4a90-849e-db9e78ad56db/document/148a3c61-54cf-490a-a782-cbf6b9a787ca
[Log] Document 148a3c61-54cf-490a-a782-cbf6b9a787ca added to conversation 65107daf-b0b4-4a90-849e-db9e78ad56db
[Log] Document successfully associated with conversation
[Log] [Fast Refresh] rebuilding
[Log] PDFViewer unmounting, cleaning up resources
[Log] Sending GET request to http://localhost:8000/api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca/citations
[Log] [Fast Refresh] done in 217ms
[Log] [Fast Refresh] done in 288ms
[Log] Deprecated API usage: The `enhanceTextSelection` functionality will be removed in the future. (x2)
[Error] Source Map loading errors (x2)
[Error] Failed to load resource: the server responded with a status of 404 (Not Found) (types.js.map, line 0)
[Error] Failed to load resource: the server responded with a status of 404 (Not Found) (types.js.map, line 0)
[Log] Submit conditions: useStreaming=true, conversationId=65107daf-b0b4-4a90-849e-db9e78ad56db, isConnected=true
[Log] Using WebSocket streaming for message submission
[Log] ğŸ”„ Starting new message - reset streaming state
[Log] Message start: Set streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ”„ Starting new message - reset streaming state
[Log] Message start: Set streamingMessageId to msg_01LQSaMj4eHy3DWJUF672Ba8
[Log] ğŸ“ Building initial streaming: 3 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 3 chars
[Log] ğŸ“ Building initial streaming: 16 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 16 chars
[Log] ğŸ“ Building initial streaming: 71 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 71 chars
[Log] ğŸ“ Building initial streaming: 85 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 85 chars
[Log] ğŸ“ Building initial streaming: 97 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 97 chars
[Log] ğŸ“ Building initial streaming: 102 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 102 chars
[Log] ğŸ“ Building initial streaming: 107 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 107 chars
[Log] ğŸ“ Building initial streaming: 135 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 135 chars
[Log] ğŸ“ Building initial streaming: 156 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 156 chars
[Log] ğŸ“ Building initial streaming: 160 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 160 chars
[Log] ğŸ“ Building initial streaming: 184 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 184 chars
[Log] ğŸ“ Building initial streaming: 189 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 189 chars
[Log] ğŸ“ Building initial streaming: 190 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 190 chars
[Log] ğŸ“ Building initial streaming: 199 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 199 chars
[Log] ğŸ“ Building initial streaming: 204 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 204 chars
[Log] ğŸ“ Building initial streaming: 206 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 206 chars
[Log] ğŸ“ Building initial streaming: 213 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 213 chars
[Log] ğŸ“ Building initial streaming: 227 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 227 chars
[Log] ğŸ“ Building initial streaming: 238 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 238 chars
[Log] ğŸ“ Building initial streaming: 242 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 242 chars
[Log] ğŸ“ Building initial streaming: 247 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 247 chars
[Log] ğŸ“ Building initial streaming: 254 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 254 chars
[Log] ğŸ“ Building initial streaming: 258 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 258 chars
[Log] ğŸ“ Building initial streaming: 276 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 276 chars
[Log] ğŸ“ Building initial streaming: 279 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 279 chars
[Log] ğŸ“ Building initial streaming: 303 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 303 chars
[Log] ğŸ“ Building initial streaming: 312 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 312 chars
[Log] ğŸ“ Building initial streaming: 336 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 336 chars
[Log] ğŸ“ Building initial streaming: 355 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 355 chars
[Log] ğŸ“ Building initial streaming: 356 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 356 chars
[Log] ğŸ“ Building initial streaming: 365 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 365 chars
[Log] ğŸ“ Building initial streaming: 374 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 374 chars
[Log] ğŸ“ Building initial streaming: 388 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 388 chars
[Log] ğŸ“ Building initial streaming: 425 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 425 chars
[Log] ğŸ“ Building initial streaming: 442 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 442 chars
[Log] ğŸ“ Building initial streaming: 446 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 446 chars
[Log] ğŸ“ Building initial streaming: 455 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 455 chars
[Log] ğŸ“ Building initial streaming: 458 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 458 chars
[Log] ğŸ“ Building initial streaming: 459 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 459 chars
[Log] ğŸ“ Building initial streaming: 466 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 466 chars
[Log] ğŸ“ Building initial streaming: 477 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 477 chars
[Log] ğŸ“ Building initial streaming: 481 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 481 chars
[Log] ğŸ“ Building initial streaming: 510 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 510 chars
[Log] ğŸ“ Building initial streaming: 538 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 538 chars
[Log] ğŸ“ Building initial streaming: 549 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 549 chars
[Log] ğŸ“ Building initial streaming: 553 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 553 chars
[Log] ğŸ“ Building initial streaming: 561 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 561 chars
[Log] ğŸ“ Building initial streaming: 592 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 592 chars
[Log] ğŸ“ Building initial streaming: 600 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 600 chars
[Log] ğŸ“ Building initial streaming: 627 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 627 chars
[Log] ğŸ“ Building initial streaming: 640 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 640 chars
[Log] ğŸ“ Building initial streaming: 655 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 655 chars
[Log] ğŸ“ Building initial streaming: 697 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 697 chars
[Log] ğŸ“ Building initial streaming: 725 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 725 chars
[Log] ğŸ“ Building initial streaming: 743 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 743 chars
[Log] ğŸ“ Building initial streaming: 751 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 751 chars
[Log] ğŸ“ Building initial streaming: 767 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 767 chars
[Log] ğŸ“ Building initial streaming: 793 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 793 chars
[Log] ğŸ“ Building initial streaming: 810 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 810 chars
[Log] ğŸ“ Building initial streaming: 818 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 818 chars
[Log] ğŸ§Š FREEZING initial message at tool start: "..." (0 chars)
[Log] Tool start: Setting missing streamingMessageId to msg_01LQSaMj4eHy3DWJUF672Ba8
[Log] Tool complete: Setting missing streamingMessageId to msg_01LQSaMj4eHy3DWJUF672Ba8
[Log] Tool complete: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ”„ Starting new message - reset streaming state
[Log] Message start: Set streamingMessageId to msg_01EJqNGYYPeF1q7b8JmgTehE
[Log] ğŸ§Š FREEZING initial message at tool start: "..." (0 chars)
[Log] Tool start: Setting missing streamingMessageId to msg_01EJqNGYYPeF1q7b8JmgTehE
[Log] Tool complete: Setting missing streamingMessageId to msg_01EJqNGYYPeF1q7b8JmgTehE
[Log] Tool complete: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ”„ Starting new message - reset streaming state
[Log] Message start: Set streamingMessageId to msg_01KRMAC7MjdcJgmZFudxm7fw
[Log] ğŸ§Š FREEZING initial message at tool start: "..." (0 chars)
[Log] Tool start: Setting missing streamingMessageId to msg_01KRMAC7MjdcJgmZFudxm7fw
[Log] Tool complete: Setting missing streamingMessageId to msg_01KRMAC7MjdcJgmZFudxm7fw
[Log] Tool complete: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ”„ Starting new message - reset streaming state
[Log] Message start: Set streamingMessageId to msg_01XKtJ1sXv3H7idDGaZwmG4k
[Log] ğŸ§Š FREEZING initial message at tool start: "..." (0 chars)
[Log] Tool start: Setting missing streamingMessageId to msg_01XKtJ1sXv3H7idDGaZwmG4k
[Log] Tool complete: Setting missing streamingMessageId to msg_01XKtJ1sXv3H7idDGaZwmG4k
[Log] Tool complete: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ”„ Starting new message - reset streaming state
[Log] Message start: Set streamingMessageId to msg_014bgCo8FLPASgdAmUfGv9by
[Log] ğŸ“ Building initial streaming: 3 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 3 chars
[Log] ğŸ“ Building initial streaming: 30 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 30 chars
[Log] ğŸ“ Building initial streaming: 42 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 42 chars
[Log] ğŸ“ Building initial streaming: 47 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 47 chars
[Log] ğŸ“ Building initial streaming: 89 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 89 chars
[Log] ğŸ“ Building initial streaming: 117 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 117 chars
[Log] ğŸ“ Building initial streaming: 132 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 132 chars
[Log] ğŸ“ Building initial streaming: 141 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 141 chars
[Log] ğŸ“ Building initial streaming: 157 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 157 chars
[Log] ğŸ“ Building initial streaming: 184 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 184 chars
[Log] ğŸ“ Building initial streaming: 218 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 218 chars
[Log] ğŸ“ Building initial streaming: 227 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 227 chars
[Log] ğŸ“ Building initial streaming: 248 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 248 chars
[Log] ğŸ“ Building initial streaming: 271 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 271 chars
[Log] ğŸ“ Building initial streaming: 298 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 298 chars
[Log] ğŸ“ Building initial streaming: 302 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 302 chars
[Log] ğŸ“ Building initial streaming: 309 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 309 chars
[Log] ğŸ“ Building initial streaming: 317 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 317 chars
[Log] ğŸ“ Building initial streaming: 322 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 322 chars
[Log] ğŸ“ Building initial streaming: 348 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 348 chars
[Log] ğŸ“ Building initial streaming: 364 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 364 chars
[Log] ğŸ“ Building initial streaming: 386 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 386 chars
[Log] ğŸ“ Building initial streaming: 409 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 409 chars
[Log] ğŸ“ Building initial streaming: 438 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 438 chars
[Log] ğŸ“ Building initial streaming: 466 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 466 chars
[Log] ğŸ“ Building initial streaming: 488 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 488 chars
[Log] ğŸ“ Building initial streaming: 508 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 508 chars
[Log] ğŸ“ Building initial streaming: 519 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 519 chars
[Log] ğŸ“ Building initial streaming: 542 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 542 chars
[Log] ğŸ“ Building initial streaming: 547 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 547 chars
[Log] ğŸ“ Building initial streaming: 573 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 573 chars
[Log] ğŸ“ Building initial streaming: 582 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 582 chars
[Log] ğŸ“ Building initial streaming: 588 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 588 chars
[Log] ğŸ“ Building initial streaming: 599 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 599 chars
[Log] ğŸ“ Building initial streaming: 607 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 607 chars
[Log] ğŸ“ Building initial streaming: 635 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 635 chars
[Log] ğŸ“ Building initial streaming: 665 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 665 chars
[Log] ğŸ“ Building initial streaming: 677 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 677 chars
[Log] ğŸ“ Building initial streaming: 685 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 685 chars
[Log] ğŸ“ Building initial streaming: 707 chars
[Log] Content update: Setting missing streamingMessageId to 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
[Log] ğŸ“ Initial streaming update: 707 chars
[Error] Streaming error: â€“ "Error processing message: A transaction is already begun on this Session."
	(anonymous function) (app-index.js:33)
	(anonymous function) (hydration-error-info.js:63)
	onError (StreamingChatInterface.tsx:46)
	(anonymous function) (useStreamingChat.ts:270)
	(anonymous function) (useStreamingChat.ts:353)
[Log] Checking 2 messages for cumulative visualization data...
[Log] No structured visualization data found in messages or analysis results, returning empty structure
[Log] Checking 2 messages for cumulative visualization data...
[Log] No structured visualization data found in messages or analysis results, returning empty structure
[Log] PDFViewer unmounting, cleaning up resources
[Log] Checking 2 messages for cumulative visualization data...
[Log] No structured visualization data found in messages or analysis results, returning empty structure
[Log] Checking 2 messages for cumulative visualization data...
[Log] No structured visualization data found in messages or analysis results, returning empty structure


</JavaScript_Console_Output>

<Backend_Logs>
(venv) alexcardell@Alexs-MBP backend % cd /Users/alexcardell/AlexCoding_Local/cfin/backend && PYTHONPATH=$PYTHONPATH:/Users/alexcardell/AlexCoding_Local/cfin/backend python -m uvicorn app.main:app --reload --port 8000
INFO:     Will watch for changes in these directories: ['/Users/alexcardell/AlexCoding_Local/cfin/backend']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [1250] using StatReload
INFO:root:Loaded environment variables from /Users/alexcardell/AlexCoding_Local/cfin/.env
INFO:root:ANTHROPIC_API_KEY loaded: sk-ant-a...TQAA
INFO:app.main:CORS: Allowing origins: ['http://localhost:3000', 'http://localhost:3001', 'http://localhost:3002', 'http://localhost:3003', 'http://127.0.0.1:3000', 'http://127.0.0.1:3001', 'http://127.0.0.1:3002', 'http://127.0.0.1:3003', 'http://127.0.0.1:49937', 'http://127\\.0\\.0\\.1:\\d+', 'http://127.0.0.1:64142']
INFO:     Started server process [1252]
INFO:     Waiting for application startup.
INFO:app.main:Initializing database...
INFO:utils.init_db:Creating database tables...
INFO:utils.init_db:Database tables created successfully.
INFO:utils.init_db:Default user already exists.
INFO:utils.init_db:Database initialization completed successfully.
INFO:app.main:Database initialization completed successfully
INFO:     Application startup complete.
INFO:     127.0.0.1:59585 - "OPTIONS /api/conversation HTTP/1.1" 200 OK
INFO:     127.0.0.1:59586 - "OPTIONS /api/conversation HTTP/1.1" 200 OK
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.conversation:Created conversation: 65107daf-b0b4-4a90-849e-db9e78ad56db for user: default-user
INFO:app.routes.conversation:Created conversation: 0869c945-1f6f-4132-96af-b988bf4a3490 for user: default-user
INFO:     127.0.0.1:59585 - "POST /api/conversation HTTP/1.1" 201 Created
INFO:     127.0.0.1:59586 - "POST /api/conversation HTTP/1.1" 201 Created
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     127.0.0.1:59585 - "GET /api/conversation/65107daf-b0b4-4a90-849e-db9e78ad56db HTTP/1.1" 200 OK
INFO:app.routes.websocket:WebSocket endpoint called for conversation: 65107daf-b0b4-4a90-849e-db9e78ad56db, user: default-user
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     ('127.0.0.1', 59586) - "WebSocket /ws/conversation/65107daf-b0b4-4a90-849e-db9e78ad56db" [accepted]
INFO:app.routes.websocket:WebSocket connected: default-user_65107daf-b0b4-4a90-849e-db9e78ad56db_1750452170305
INFO:app.routes.websocket:WebSocket connection established for conversation: 65107daf-b0b4-4a90-849e-db9e78ad56db
INFO:     connection open
INFO:app.routes.websocket:Found conversation: 65107daf-b0b4-4a90-849e-db9e78ad56db
INFO:     127.0.0.1:59587 - "OPTIONS /api/documents/upload HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:utils.storage:File 148a3c61-54cf-490a-a782-cbf6b9a787ca.pdf saved to ./uploads/148a3c61-54cf-490a-a782-cbf6b9a787ca.pdf
INFO:     127.0.0.1:59587 - "POST /api/documents/upload HTTP/1.1" 200 OK
INFO:pdf_processing.document_service:Starting optimized processing of document 148a3c61-54cf-490a-a782-cbf6b9a787ca (Bank_5Q_Trend_Report.pdf) with Claude Files API
INFO:pdf_processing.document_service:No cached file_id for document 148a3c61-54cf-490a-a782-cbf6b9a787ca, performing full processing
INFO:pdf_processing.api_service:Processing PDF: Bank_5Q_Trend_Report.pdf with Claude API using native PDF support.
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/files "HTTP/1.1 200 OK"
INFO:utils.file_cache:Cached file_id=file_011CQL86zLhJhaDSwjrgDsFK for content hash=9c15100a12f1a9ad... (expires: 2025-09-18 15:42:57, cache size: 1)
INFO:audit.pdf_access:PDF_ACCESS: {'timestamp': 'AUTO', 'operation': 'upload', 'file_id': 'file_011CQL86zLhJhaDSwjrgDsFK', 'user_context': 'system', 'file_size_bytes': 29802, 'privacy_note': 'PDF content not logged for compliance'}
INFO:pdf_processing.claude_file_client:Uploaded Bank_5Q_Trend_Report.pdf (0.0 MB) â†’ file_011CQL86zLhJhaDSwjrgDsFK
INFO:pdf_processing.api_service:Generated Claude file_id file_011CQL86zLhJhaDSwjrgDsFK for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Analyzing document type for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Analyzing document type for Bank_5Q_Trend_Report.pdf using file_id=file_011CQL86zLhJhaDSwjrgDsFK
INFO:pdf_processing.model_router:Using Haiku for light tools set() with 1000 tokens (haiku_calls=1, sonnet_calls=0)
INFO:pdf_processing.api_service:Model router selected claude-3-5-haiku-20241022 for document type analysis
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (non-streaming): 117 (Custom estimate: 117)
INFO:pdf_processing.api_service:Throttling based on token count: 117 (SDK count: 117, Custom estimate: 117)
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
WARNING:pdf_processing.api_service:Invalid document type 'balance_sheet, income_statement, credit_quality_kpis', using OTHER
INFO:pdf_processing.api_service:Document Bank_5Q_Trend_Report.pdf classified as other with periods: ['2024Q1', '2024Q2', '2024Q3', '2024Q4', '2025Q1']
INFO:pdf_processing.api_service:Document Bank_5Q_Trend_Report.pdf classified as: other with periods: ['2024Q1', '2024Q2', '2024Q3', '2024Q4', '2025Q1']
INFO:pdf_processing.api_service:Extracting structured financial data and citations for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Extracting structured financial data with citations from: Bank_5Q_Trend_Report.pdf using file_id file_011CQL86zLhJhaDSwjrgDsFK
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (non-streaming): 177 (Custom estimate: 101)
INFO:pdf_processing.api_service:Throttling based on token count: 177 (SDK count: 177, Custom estimate: 101)
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Successfully parsed financial JSON from Claude's response.
INFO:pdf_processing.api_service:Captured Claude's preamble text, length: 240
INFO:pdf_processing.api_service:Extracted 0 citations for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.api_service:Structured financial data keys for Bank_5Q_Trend_Report.pdf: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json']
INFO:pdf_processing.api_service:Added claude_file_id file_011CQL86zLhJhaDSwjrgDsFK to extracted_data for Bank_5Q_Trend_Report.pdf
INFO:pdf_processing.document_service:Processed document using Files API: PDF Bank_5Q_Trend_Report.pdf processed using Claude's native PDF support via Files API
INFO:pdf_processing.document_service:Extracted claude_file_id file_011CQL86zLhJhaDSwjrgDsFK from processed document data
INFO:pdf_processing.document_service:Stored claude_file_id file_011CQL86zLhJhaDSwjrgDsFK in database for document 148a3c61-54cf-490a-a782-cbf6b9a787ca
INFO:pdf_processing.document_service:Updating document 148a3c61-54cf-490a-a782-cbf6b9a787ca content with Claude optimizations using Files API
INFO:pdf_processing.document_service:Document 148a3c61-54cf-490a-a782-cbf6b9a787ca processed with Claude optimizations. File ID: file_011CQL86zLhJhaDSwjrgDsFK
INFO:pdf_processing.document_service:Storing 0 citations for document 148a3c61-54cf-490a-a782-cbf6b9a787ca
INFO:pdf_processing.document_service:Successfully completed optimized processing for document 148a3c61-54cf-490a-a782-cbf6b9a787ca
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Document 148a3c61-54cf-490a-a782-cbf6b9a787ca accepted for financial analysis
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca/check-financial-data HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Document 148a3c61-54cf-490a-a782-cbf6b9a787ca accepted for financial analysis
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca/check-financial-data HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "OPTIONS /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca/verify-financial-data HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Document 148a3c61-54cf-490a-a782-cbf6b9a787ca has extracted_data with keys: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json', 'claude_file_id']
INFO:     127.0.0.1:59587 - "POST /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca/verify-financial-data HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:     127.0.0.1:59587 - "OPTIONS /api/conversation/65107daf-b0b4-4a90-849e-db9e78ad56db/document/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:services.conversation_service:Found ANTHROPIC_API_KEY in environment variables: sk-ant-a...TQAA
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:     127.0.0.1:59587 - "POST /api/conversation/65107daf-b0b4-4a90-849e-db9e78ad56db/document/148a3c61-54cf-490a-a782-cbf6b9a787ca HTTP/1.1" 200 OK
INFO:pdf_processing.api_service:ClaudeService initialized with model: claude-3-5-sonnet-20241022, PDF support, timeout=90s, max_retries=5, headers: {'anthropic-beta': 'token-efficient-tools-2025-02-19,files-api-2025-04-14,fine-grained-tool-streaming-2025-05-14'}
INFO:pdf_processing.langgraph_service:LangGraphService initialized with model: claude-3-5-sonnet-20241022
INFO:pdf_processing.api_service:LangGraph service successfully initialized
INFO:app.routes.document:Retrieving file for document: 148a3c61-54cf-490a-a782-cbf6b9a787ca
INFO:app.routes.document:Returning binary PDF data for document 148a3c61-54cf-490a-a782-cbf6b9a787ca, size: 29802 bytes
INFO:     127.0.0.1:59587 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca/file HTTP/1.1" 200 OK
INFO:     127.0.0.1:59613 - "GET /api/documents/148a3c61-54cf-490a-a782-cbf6b9a787ca/citations HTTP/1.1" 200 OK
INFO:app.routes.websocket:WEBSOCKET_FLOW: Sent message_start event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: Starting conversation processing for conversation: 65107daf-b0b4-4a90-849e-db9e78ad56db
INFO:repositories.document_repository:Retrieving document content using file path: 148a3c61-54cf-490a-a782-cbf6b9a787ca.pdf
INFO:repositories.document_repository:Requesting file from storage service for document 148a3c61-54cf-490a-a782-cbf6b9a787ca
INFO:repositories.document_repository:Retrieved PDF content for document 148a3c61-54cf-490a-a782-cbf6b9a787ca: 29802 bytes
INFO:repositories.document_repository:Document 148a3c61-54cf-490a-a782-cbf6b9a787ca has claude_file_id: file_011CQL86zLhJhaDSwjrgDsFK (native PDF support available)
INFO:repositories.document_repository:PDF document 148a3c61-54cf-490a-a782-cbf6b9a787ca uses claude_file_id for native support - raw_text not required
INFO:repositories.document_repository:Extracted data available for document 148a3c61-54cf-490a-a782-cbf6b9a787ca: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json', 'claude_file_id']
INFO:repositories.document_repository:Successfully retrieved content for document 148a3c61-54cf-490a-a782-cbf6b9a787ca
INFO:services.conversation_service:Retrieved content for document 148a3c61-54cf-490a-a782-cbf6b9a787ca: content size=29802, raw_text size=0
INFO:services.conversation_service:Document 148a3c61-54cf-490a-a782-cbf6b9a787ca available content types: content, extracted_data
INFO:services.conversation_service:Added document 148a3c61-54cf-490a-a782-cbf6b9a787ca to context for conversation 65107daf-b0b4-4a90-849e-db9e78ad56db
INFO:repositories.document_repository:Retrieving document content using file path: 148a3c61-54cf-490a-a782-cbf6b9a787ca.pdf
INFO:repositories.document_repository:Requesting file from storage service for document 148a3c61-54cf-490a-a782-cbf6b9a787ca
INFO:repositories.document_repository:Retrieved PDF content for document 148a3c61-54cf-490a-a782-cbf6b9a787ca: 29802 bytes
INFO:repositories.document_repository:Document 148a3c61-54cf-490a-a782-cbf6b9a787ca has claude_file_id: file_011CQL86zLhJhaDSwjrgDsFK (native PDF support available)
INFO:repositories.document_repository:PDF document 148a3c61-54cf-490a-a782-cbf6b9a787ca uses claude_file_id for native support - raw_text not required
INFO:repositories.document_repository:Extracted data available for document 148a3c61-54cf-490a-a782-cbf6b9a787ca: ['time_periods', 'balance_sheet', 'income_statement', 'credit_quality', 'claude_textual_output_accompanying_json', 'claude_file_id']
INFO:repositories.document_repository:Successfully retrieved content for document 148a3c61-54cf-490a-a782-cbf6b9a787ca
INFO:services.conversation_service:Added document 148a3c61-54cf-490a-a782-cbf6b9a787ca with Files API file_id: file_011CQL86zLhJhaDSwjrgDsFK
INFO:services.conversation_service:Using unified streaming approach with tools available for conversation 65107daf-b0b4-4a90-849e-db9e78ad56db
INFO:services.conversation_service:Using Files API claude_file_id file_011CQL86zLhJhaDSwjrgDsFK for unified streaming analysis
INFO:pdf_processing.api_service:Starting streaming analyze_with_visualization_tools for query: 'How have deposits performed?...'
INFO:pdf_processing.api_service:Streaming visualization analysis turn 1/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_comparative_period', 'generate_graph_data', 'generate_financial_metric', 'generate_table_data'} with 47 tokens (haiku_calls=1, sonnet_calls=1)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 4321 (Custom estimate: 40)
INFO:pdf_processing.api_service:Throttling based on token count: 4321 (SDK count: 4321, Custom estimate: 40)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
ERROR:sqlalchemy.pool.impl.NullPool:The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-35, started daemon 6208614400)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
/Users/alexcardell/AlexCoding_Local/venv/lib/python3.9/site-packages/pydantic/_internal/_core_utils.py:301: SAWarning: The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-35, started daemon 6208614400)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
  for v in schema['choices']:
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting message_start event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 3 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:repositories.conversation_repository:Message content length: 3
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 3 chars
INFO:services.conversation_service:CONTENT_UPDATED: Building content (3 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 3 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 16 chars
INFO:repositories.conversation_repository:Updated and re-fetched message 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:repositories.conversation_repository:Message content length: 16
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 16 chars
INFO:services.conversation_service:CONTENT_UPDATED: Building content (16 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 16 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 71 chars
INFO:services.conversation_service:ğŸ”’ STREAMING LOCKED: Protected initial content (71 chars): 'Let me provide a comprehensive analysis of deposit performance based on...'
INFO:repositories.conversation_repository:Updated and re-fetched message 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:repositories.conversation_repository:Message content length: 71
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 71 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 71 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 85 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (85 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 85 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 97 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (97 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 97 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 102 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (102 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 102 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 107 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (107 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 107 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 135 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (135 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 135 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 156 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (156 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 156 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 160 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (160 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 160 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 184 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (184 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 184 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 189 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (189 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 189 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 190 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (190 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 190 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 199 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (199 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 199 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 204 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (204 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 204 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 206 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (206 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 206 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 213 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (213 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 213 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 227 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (227 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 227 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 238 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (238 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 238 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 242 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (242 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 242 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 247 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (247 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 247 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 254 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (254 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 254 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 258 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (258 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 258 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 276 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (276 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 276 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 279 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (279 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 279 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 303 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (303 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 303 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 312 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (312 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 312 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 336 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (336 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 336 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 355 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (355 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 355 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 356 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (356 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 356 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 365 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (365 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 365 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 374 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (374 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 374 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 388 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (388 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 388 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 425 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (425 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 425 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 442 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (442 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 442 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 446 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (446 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 446 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 455 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (455 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 455 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 458 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (458 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 458 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 459 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (459 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 459 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 466 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (466 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 466 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 477 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (477 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 477 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 481 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (71 chars), rejecting update (481 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 481 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 510 chars
INFO:services.conversation_service:âœ… STREAMING UPGRADE: Accepting much better content (510 vs 71 chars)
INFO:repositories.conversation_repository:Updated and re-fetched message 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:repositories.conversation_repository:Message content length: 510
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 510 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 510 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 538 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (538 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 538 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 549 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (549 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 549 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 553 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (553 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 553 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 561 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (561 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 561 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 592 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (592 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 592 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 600 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (600 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 600 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 627 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (627 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 627 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 640 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (640 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 640 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 655 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (655 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 655 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 697 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (697 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 697 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 725 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (725 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 725 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 743 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (743 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 743 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 751 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (751 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 751 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 767 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (767 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 767 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 793 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (793 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 793 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 810 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (810 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 810 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 818 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (818 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 818 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_start event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_start - tool_id=toolu_01Qym4i7HmRYefDikkAPaGoP, tool_name=generate_graph_data
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_graph_data: type=<class 'dict'>
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: msg_01LQSaMj4eHy3DWJUF672Ba8
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01Qym4i7HmRYefDikkAPaGoP, tool_name=generate_graph_data
INFO:pdf_processing.api_service:Turn 1: Initial streaming text preserved (818 chars)
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_graph_data (ID: toolu_01Qym4i7HmRYefDikkAPaGoP)
INFO:pdf_processing.api_service:Processing streaming tool generate_graph_data (ID: toolu_01Qym4i7HmRYefDikkAPaGoP)
INFO:pdf_processing.api_service:Tool generate_graph_data (ID: toolu_01Qym4i7HmRYefDikkAPaGoP) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_graph_data (ID: toolu_01Qym4i7HmRYefDikkAPaGoP) - dict input keys: ['chartType', 'config', 'data', 'chartConfig']
INFO:utils.tool_processing:Processing generate_graph_data (ID: toolu_01Qym4i7HmRYefDikkAPaGoP) - input type: <class 'dict'>
INFO:utils.tool_processing:Starting process_chart_input with input type: <class 'dict'>
INFO:utils.tool_processing:Chart input keys: ['chartType', 'config', 'data', 'chartConfig']
INFO:utils.tool_processing:Chart config type: <class 'str'>
INFO:utils.tool_processing:Chart data type: <class 'list'>, length: 5
INFO:utils.tool_processing:Chart chartConfig type: <class 'dict'>
WARNING:utils.tool_processing:Chart config is a JSON string, parsing it
INFO:utils.tool_processing:Successfully parsed config JSON string
INFO:utils.tool_processing:Chart config keys: ['title', 'xAxisKey', 'xAxisLabel', 'yAxisLabel', 'description']
INFO:utils.tool_processing:Successfully got original_data: type=<class 'list'>
INFO:utils.tool_processing:Chart type: line
INFO:utils.tool_processing:Chart config settings type: <class 'dict'>
INFO:utils.tool_processing:x_axis_key: period
INFO:utils.tool_processing:Transforming chart data to {x, y} format required by ChartDataItem model
INFO:utils.tool_processing:Line chart with multiple series (['nonInterestDDA', 'mmda', 'savings', 'time', 'now']) - keeping flat format
INFO:utils.tool_processing:Successfully processed chart: Deposit Trends by Category
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01Qym4i7HmRYefDikkAPaGoP, tool_name=generate_graph_data
INFO:pdf_processing.api_service:Streaming visualization analysis turn 2/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_comparative_period', 'generate_graph_data', 'generate_financial_metric', 'generate_table_data'} with 946 tokens (haiku_calls=1, sonnet_calls=2)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 5548 (Custom estimate: 245)
INFO:pdf_processing.api_service:Throttling based on token count: 5548 (SDK count: 5548, Custom estimate: 245)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting message_start event with message_id: msg_01EJqNGYYPeF1q7b8JmgTehE
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_start event with message_id: msg_01EJqNGYYPeF1q7b8JmgTehE
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_start - tool_id=toolu_01PRdmjaKDQ92ChotMwMW5N3, tool_name=generate_table_data
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_table_data: type=<class 'dict'>
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: msg_01EJqNGYYPeF1q7b8JmgTehE
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01PRdmjaKDQ92ChotMwMW5N3, tool_name=generate_table_data
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_table_data (ID: toolu_01PRdmjaKDQ92ChotMwMW5N3)
INFO:pdf_processing.api_service:Processing streaming tool generate_table_data (ID: toolu_01PRdmjaKDQ92ChotMwMW5N3)
INFO:pdf_processing.api_service:Tool generate_table_data (ID: toolu_01PRdmjaKDQ92ChotMwMW5N3) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_table_data (ID: toolu_01PRdmjaKDQ92ChotMwMW5N3) - dict input keys: ['tableType', 'config', 'data']
INFO:utils.tool_processing:Processing generate_table_data (ID: toolu_01PRdmjaKDQ92ChotMwMW5N3) - input type: <class 'dict'>
INFO:utils.tool_processing:Starting process_table_input with input type: <class 'dict'>
INFO:utils.tool_processing:Table input keys: ['tableType', 'config', 'data']
INFO:utils.tool_processing:Table config type: <class 'str'>
INFO:utils.tool_processing:Table data type: <class 'list'>, length: 5
WARNING:utils.tool_processing:Table config is a JSON string, parsing it
INFO:utils.tool_processing:Successfully parsed table config JSON string
INFO:utils.tool_processing:Successfully processed table: Deposit Growth Analysis
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01PRdmjaKDQ92ChotMwMW5N3, tool_name=generate_table_data
INFO:pdf_processing.api_service:Streaming visualization analysis turn 3/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_comparative_period', 'generate_graph_data', 'generate_financial_metric', 'generate_table_data'} with 1543 tokens (haiku_calls=1, sonnet_calls=3)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 6493 (Custom estimate: 245)
INFO:pdf_processing.api_service:Throttling based on token count: 6493 (SDK count: 6493, Custom estimate: 245)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting message_start event with message_id: msg_01KRMAC7MjdcJgmZFudxm7fw
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_start event with message_id: msg_01KRMAC7MjdcJgmZFudxm7fw
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_start - tool_id=toolu_01VDLMyjRhmyjGBwqYyny5dT, tool_name=generate_financial_metric
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_financial_metric: type=<class 'dict'>
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: msg_01KRMAC7MjdcJgmZFudxm7fw
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01VDLMyjRhmyjGBwqYyny5dT, tool_name=generate_financial_metric
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_financial_metric (ID: toolu_01VDLMyjRhmyjGBwqYyny5dT)
INFO:pdf_processing.api_service:Processing streaming tool generate_financial_metric (ID: toolu_01VDLMyjRhmyjGBwqYyny5dT)
INFO:pdf_processing.api_service:Tool generate_financial_metric (ID: toolu_01VDLMyjRhmyjGBwqYyny5dT) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_financial_metric (ID: toolu_01VDLMyjRhmyjGBwqYyny5dT) - dict input keys: ['category', 'name', 'period', 'value', 'unit', 'isEstimated']
INFO:utils.tool_processing:Processing generate_financial_metric (ID: toolu_01VDLMyjRhmyjGBwqYyny5dT) - input type: <class 'dict'>
INFO:utils.tool_processing:Successfully processed financial metric: Total Deposit Growth
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01VDLMyjRhmyjGBwqYyny5dT, tool_name=generate_financial_metric
INFO:pdf_processing.api_service:Streaming visualization analysis turn 4/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_comparative_period', 'generate_graph_data', 'generate_financial_metric', 'generate_table_data'} with 1659 tokens (haiku_calls=1, sonnet_calls=4)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 6712 (Custom estimate: 245)
INFO:pdf_processing.api_service:Throttling based on token count: 6712 (SDK count: 6712, Custom estimate: 245)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting message_start event with message_id: msg_01XKtJ1sXv3H7idDGaZwmG4k
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_start event with message_id: msg_01XKtJ1sXv3H7idDGaZwmG4k
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_start - tool_id=toolu_01MgVXrpyTH73SmMbvKxqJ9D, tool_name=generate_financial_metric
INFO:pdf_processing.api_service:Raw tool input from Claude for generate_financial_metric: type=<class 'dict'>
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: msg_01XKtJ1sXv3H7idDGaZwmG4k
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01MgVXrpyTH73SmMbvKxqJ9D, tool_name=generate_financial_metric
INFO:pdf_processing.api_service:Received 1 tool calls from streaming response
INFO:pdf_processing.api_service:Tool call: generate_financial_metric (ID: toolu_01MgVXrpyTH73SmMbvKxqJ9D)
INFO:pdf_processing.api_service:Processing streaming tool generate_financial_metric (ID: toolu_01MgVXrpyTH73SmMbvKxqJ9D)
INFO:pdf_processing.api_service:Tool generate_financial_metric (ID: toolu_01MgVXrpyTH73SmMbvKxqJ9D) - input type: <class 'dict'>
INFO:pdf_processing.api_service:Tool generate_financial_metric (ID: toolu_01MgVXrpyTH73SmMbvKxqJ9D) - dict input keys: ['category', 'name', 'period', 'value', 'unit', 'isEstimated']
INFO:utils.tool_processing:Processing generate_financial_metric (ID: toolu_01MgVXrpyTH73SmMbvKxqJ9D) - input type: <class 'dict'>
INFO:utils.tool_processing:Successfully processed financial metric: Average Quarterly Growth Rate
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting tool_complete event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: tool_complete - tool_id=toolu_01MgVXrpyTH73SmMbvKxqJ9D, tool_name=generate_financial_metric
INFO:pdf_processing.api_service:Streaming visualization analysis turn 5/5
INFO:pdf_processing.model_router:Using Sonnet for tools {'generate_comparative_period', 'generate_graph_data', 'generate_financial_metric', 'generate_table_data'} with 1779 tokens (haiku_calls=1, sonnet_calls=5)
INFO:pdf_processing.api_service:Executing tool interaction turn with model_router selected model: claude-3-5-sonnet-20241022, 4 tools available, streaming: True
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages/count_tokens "HTTP/1.1 200 OK"
INFO:pdf_processing.api_service:Anthropic SDK estimated input tokens (streaming): 6933 (Custom estimate: 245)
INFO:pdf_processing.api_service:Throttling based on token count: 6933 (SDK count: 6933, Custom estimate: 245)
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting message_start event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 3 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (3 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 3 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 30 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (30 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 30 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 42 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (42 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 42 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 47 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (47 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 47 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 89 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (89 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 89 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 117 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (117 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 117 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 132 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (132 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 132 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 141 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (141 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 141 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 157 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (157 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 157 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 184 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (184 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 184 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 218 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (218 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 218 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 227 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (227 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 227 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 248 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (248 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 248 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 271 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (271 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 271 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 298 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (298 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 298 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 302 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (302 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 302 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 309 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (309 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 309 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 317 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (317 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 317 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 322 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (322 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 322 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 348 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (348 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 348 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 364 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (364 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 364 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 386 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (386 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 386 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 409 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (409 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 409 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 438 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (438 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 438 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 466 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (466 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 466 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 488 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (488 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 488 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 508 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (508 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 508 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 519 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (519 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 519 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 542 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (542 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 542 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 547 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (547 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 547 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 573 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (573 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 573 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 582 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (582 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 582 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 588 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (588 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 588 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 599 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (599 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 599 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 607 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (607 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 607 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 635 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (635 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 635 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 665 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (665 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 665 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 677 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (677 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 677 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 685 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (685 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 685 chars
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting text_delta event with message_id: msg_014bgCo8FLPASgdAmUfGv9by
INFO:app.routes.websocket:WEBSOCKET_FLOW: text_delta content length: 707 chars
INFO:services.conversation_service:ğŸ›¡ï¸ STREAMING PROTECTED: Keeping initial content (510 chars), rejecting update (707 chars)
INFO:app.routes.websocket:WEBSOCKET_FLOW: Emitting content_update event with message_id: 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:app.routes.websocket:WEBSOCKET_FLOW: content_update content length: 707 chars
INFO:pdf_processing.api_service:Turn 5: Adding new content (707 chars)
INFO:pdf_processing.api_service:Streaming visualization analysis completed: no more tools
INFO:pdf_processing.api_service:Streaming visualization analysis completed: 1 charts, 1 tables, 2 metrics. Analysis text length: 1527
INFO:services.conversation_service:Current assistant message content length: 510
INFO:services.conversation_service:Analysis text length: 1527
INFO:services.conversation_service:Initial content established: True
INFO:services.conversation_service:ğŸ”’ FINAL DECISION: Using PROTECTED streaming content (510 chars)
INFO:services.conversation_service:PROTECTED CONTENT: 'Let me provide a comprehensive analysis of deposit performance based on the financial statements.

The bank's deposit performance shows steady growth ...'
INFO:repositories.conversation_repository:Updated and re-fetched message 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
INFO:repositories.conversation_repository:Message content length: 510
INFO:repositories.conversation_repository:Analysis blocks count: 0
INFO:repositories.conversation_repository:Content update verified: 510 chars
INFO:services.conversation_service:DATABASE WRITE COMPLETED: Final content length: 510 chars
INFO:services.conversation_service:PROTECTION STATUS: Initial content was protected and preserved
INFO:services.conversation_service:Sent message_update event for 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f after streaming complete
INFO:services.conversation_service:DEBUG: result.get('metrics'): [{'category': 'Deposits', 'name': 'Total Deposit Growth', 'period': '2024Q1-2025Q1', 'value': 3.7, 'unit': '%', 'isEstimated': False}, {'category': 'Deposits', 'name': 'Average Quarterly Growth Rate', 'period': '2024Q1-2025Q1', 'value': 0.91, 'unit': '%', 'isEstimated': True}]
INFO:services.conversation_service:DEBUG: accumulated_metrics: [{'category': 'Deposits', 'name': 'Total Deposit Growth', 'period': '2024Q1-2025Q1', 'value': 3.7, 'unit': '%', 'isEstimated': False}, {'category': 'Deposits', 'name': 'Average Quarterly Growth Rate', 'period': '2024Q1-2025Q1', 'value': 0.91, 'unit': '%', 'isEstimated': True}]
INFO:services.conversation_service:Processing visualizations for conversation 65107daf-b0b4-4a90-849e-db9e78ad56db: charts=1, tables=1, metrics=2
INFO:services.conversation_service:Processing chart: Deposit Trends by Category
INFO:services.conversation_service:Processing table: Deposit Growth Analysis
INFO:services.conversation_service:Processing metric: Total Deposit Growth
INFO:services.conversation_service:Processing metric: Average Quarterly Growth Rate
INFO:services.conversation_service:Storing 4 analysis blocks for streaming message 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f
ERROR:app.routes.websocket:WEBSOCKET_FLOW: Error handling streaming message 0a7732e0-01d7-4d89-ac36-dcd7c837ae7f: A transaction is already begun on this Session.
Traceback (most recent call last):
  File "/Users/alexcardell/AlexCoding_Local/cfin/backend/app/routes/websocket.py", line 256, in handle_streaming_message
    result = await conversation_service.process_user_message_streaming(
  File "/Users/alexcardell/AlexCoding_Local/cfin/backend/services/conversation_service.py", line 1135, in process_user_message_streaming
    await self._store_analysis_blocks_atomically(
  File "/Users/alexcardell/AlexCoding_Local/cfin/backend/services/conversation_service.py", line 1876, in _store_analysis_blocks_atomically
    async with self.conversation_repository.db.begin() as transaction:
  File "/Users/alexcardell/AlexCoding_Local/venv/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/base.py", line 125, in __aenter__
    return await self.start(is_ctxmanager=True)
  File "/Users/alexcardell/AlexCoding_Local/venv/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py", line 1869, in start
    await greenlet_spawn(
  File "/Users/alexcardell/AlexCoding_Local/venv/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 179, in greenlet_spawn
    result = context.switch(*args, **kwargs)
  File "/Users/alexcardell/AlexCoding_Local/venv/lib/python3.9/site-packages/sqlalchemy/orm/session.py", line 1880, in begin
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: A transaction is already begun on this Session.
ERROR:app.routes.websocket:WEBSOCKET_FLOW: Conversation 65107daf-b0b4-4a90-849e-db9e78ad56db processing failed

</Backend_Logs>